<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    <title>Python Library - Flask SQLAlchemy | JiFu&#39;s Wiki</title>
    
    
        <meta name="keywords" content="Python,Library">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="What is Flask-SQLAlchemyFlask-SQLAlchemy is a Flask microframework extension which adds support for the SQLAlchemy SQL toolkit/ORM.  Example from flask import Flask from flask_sqlalchemy import SQLAlc">
<meta name="keywords" content="Python,Library">
<meta property="og:type" content="article">
<meta property="og:title" content="Python Library - Flask SQLAlchemy">
<meta property="og:url" content="http://www.jifu.io/posts/383305840/index.html">
<meta property="og:site_name" content="JiFu&#39;s Wiki">
<meta property="og:description" content="What is Flask-SQLAlchemyFlask-SQLAlchemy is a Flask microframework extension which adds support for the SQLAlchemy SQL toolkit/ORM.  Example from flask import Flask from flask_sqlalchemy import SQLAlc">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://www.jifu.io/images/2/maxresdefault.jpg">
<meta property="og:updated_time" content="2020-08-11T05:17:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python Library - Flask SQLAlchemy">
<meta name="twitter:description" content="What is Flask-SQLAlchemyFlask-SQLAlchemy is a Flask microframework extension which adds support for the SQLAlchemy SQL toolkit/ORM.  Example from flask import Flask from flask_sqlalchemy import SQLAlc">
<meta name="twitter:image" content="https://www.jifu.io/images/2/maxresdefault.jpg">
    

    
        <link rel="alternate" href="/atom.xml" title="JiFu&#39;s Wiki" type="application/atom+xml">
    

    
        <link rel="icon" href="/favicon.ico">
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">
    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    
        <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?efa1eb5f56c438a850a0f60609fd7755";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    


<link rel="stylesheet" href="/css/prism-duotone-light.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
</html>
<body>
    <div id="container">
        <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

<header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">JiFu&#39;s Wiki</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id='categories'>
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id='allExpand' href="#">
                <i class="fa fa-angle-double-up fa-2x"></i>
            </a>
        </h3>

        
        
         <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                HR
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3142539384/">HR常用的招聘邮件模板</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Hardware
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3904818761/">MacBook十年进化史</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                OPS
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Docker
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1245529498/">Docker学习笔记</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Editor
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/151598530/">VScdoe error:Could not create temporary directory Permission denied</a></li>  <li class="file"><a href="/posts/4167799419/">Build personal development editor with vscode</a></li>  <li class="file"><a href="/posts/4165683660/">REST Client 简单好用的接口测试辅助工具</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                Linux
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                CentOS
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1153610031/">centos7修改启动内核，删除无用内核</a></li>  <li class="file"><a href="/posts/920993072/">CentOS update Ruby</a></li>  <li class="file"><a href="/posts/1867760035/">CentOS7编译安装VIM8</a></li>  <li class="file"><a href="/posts/4057676473/">yum提示Error: rpmdb open failed的解决方案</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                System Service
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/709002730/">使用 systemctl 添加自定义服务</a></li>  <li class="file"><a href="/posts/797311580/">服务管理工具 - systemctl</a></li>  <li class="file"><a href="/posts/4024224000/">Linux swap分区及作用详解</a></li>  <li class="file"><a href="/posts/55221137/">防火墙工具 - firewalld</a></li>  </ul> 
                        </li>
                         <li class="file"><a href="/posts/3897848060/">Mac使用SSH登录Google Cloud Platform</a></li>  <li class="file"><a href="/posts/4070386720/">Linux系统目录结构及详细说明</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                MacOS
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/4001059579/">Compiling PyQt5 for Python2.7 on Mac OS</a></li>  <li class="file"><a href="/posts/3746871293/">Charles从入门到精通</a></li>  <li class="file"><a href="/posts/662287335/">MACOS BOOT CAMP – THE STARTUP DISK DOES NOT HAVE ENOUGH SPACE TO BE PARTITIONED</a></li>  <li class="file"><a href="/posts/1883980072/">Mac OS系统加速：干掉那些「炫酷」的动画</a></li>  <li class="file"><a href="/posts/3837318570/">Mac VSCode 禁用GPU加速</a></li>  <li class="file"><a href="/posts/4147446761/">Mac 时间机器 Time Machine 备份速度太慢的解决方法 (加速备份命令)</a></li>  <li class="file"><a href="/posts/581320548/">Homebrew：让你从 Mac 切换到 Linux 更轻松</a></li>  <li class="file"><a href="/posts/2733308530/">Mac定时任务-利用launchctl定时启动任务</a></li>  <li class="file"><a href="/posts/294187676/">Mac版迅雷优化,删除无用插件</a></li>  <li class="file"><a href="/posts/582618556/">Mac的最大连接数限制和端口的相关参数的设置</a></li>  <li class="file"><a href="/posts/1208074722/">Mac重置系统管理控制器SMC</a></li>  <li class="file"><a href="/posts/3366946474/">Mac高效使用技巧</a></li>  <li class="file"><a href="/posts/1070186292/">SafariBookmarksSyncAgent意外退出解决方法</a></li>  <li class="file"><a href="/posts/1623087360/">修复破解Mac应用启动时闪退（原因是由于苹果移除了TNT证书）</a></li>  <li class="file"><a href="/posts/2768996547/">一览Mac OS 图形界面的发展史</a></li>  <li class="file"><a href="/posts/3807466731/">如何彻底和CrossOver说GoodBye</a></li>  <li class="file"><a href="/posts/646546052/">如何查看 macOS 系统日志，辅助排除应用程序和系统故障</a></li>  <li class="file"><a href="/posts/1207571108/">强制退出Mac程序的六种方法</a></li>  <li class="file"><a href="/posts/3920589165/">如何重置Mac上的NVRAM</a></li>  <li class="file"><a href="/posts/3430780623/">解决Mac修改DNS卡死-命令行修改Mac OS系统DNS设置</a></li>  <li class="file"><a href="/posts/558776221/">解决“Mac应用”已损坏，无法打开的问题</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Others
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2867836530/">Axel:命令行下轻量级多线程下载程序</a></li>  <li class="file"><a href="/posts/3101956195/">Git中.gitignore无效的解决办法</a></li>  <li class="file"><a href="/posts/3784546227/">Git忽略提交规则 - .gitignore配置总结</a></li>  <li class="file"><a href="/posts/3413649842/">Linux实用工具</a></li>  <li class="file"><a href="/posts/1073812833/">linux下测试磁盘的读写IO速度(IO物理测速)</a></li>  <li class="file"><a href="/posts/3895039994/">命令行信息截图工具 - ScreenFetch</a></li>  <li class="file"><a href="/posts/760033837/">平铺式窗口管理器 - Awesome</a></li>  <li class="file"><a href="/posts/1413974522/">用好这些隐藏「小开关」，让 Chrome 浏览器更好用</a></li>  <li class="file"><a href="/posts/2006196850/">私有化TM备份与共享服务器 - Netatalk</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Vim
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/258379777/">VIM下使用Vundle搭建python开发环境</a></li>  <li class="file"><a href="/posts/3374749959/">Vim快捷键使用总结</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Windows
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/913943227/">解决EXCEL按上下左右键不是单元格移动的问题</a></li>  <li class="file"><a href="/posts/3426016246/">利用windows内置工具测试硬盘速度 - winsat</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Wordpress
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1067246247/">WordPress启用memcached动态缓存以及报错解决</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                command
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3200906184/">find命令快速技巧：如何定位一个文件</a></li>  <li class="file"><a href="/posts/3403344661/">定时任务Crontab命令详解</a></li>  <li class="file"><a href="/posts/2407250830/">history命令设置linux查看历史命令显示执行时间</a></li>  <li class="file"><a href="/posts/3241041753/">通过编写 chroot 来认识 chroot 发挥的作用和它带来的好处</a></li>  </ul> 
                        </li>
                         <li class="file"><a href="/posts/404814820/">DevOps简介</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                Soft engineering
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Algorithm
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1453950584/">8大排序算法图文讲解</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Cheat Sheets
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/4169548679/">Cheat Sheets - .NET</a></li>  <li class="file"><a href="/posts/3048024619/">Cheat Sheets - Django Reference Sheet</a></li>  <li class="file"><a href="/posts/2623330927/">Cheat Sheets - PostgreSQL</a></li>  <li class="file"><a href="/posts/3433268710/">Cheat Sheets - Shell Script</a></li>  <li class="file"><a href="/posts/2993634676/">Cheat Sheets - Git</a></li>  <li class="file"><a href="/posts/3327139081/">Cheat Sheets – C++</a></li>  <li class="file"><a href="/posts/305297407/">Cheat Sheets – C</a></li>  <li class="file"><a href="/posts/2137528313/">Cheat Sheets – CSS</a></li>  <li class="file"><a href="/posts/3766000533/">Cheat Sheets – HTTP</a></li>  <li class="file"><a href="/posts/2663199359/">Cheat Sheets – Java</a></li>  <li class="file"><a href="/posts/59285358/">Cheat Sheets – HTML and XHTML</a></li>  <li class="file"><a href="/posts/982990798/">Cheat Sheets – Linux</a></li>  <li class="file"><a href="/posts/316669616/">Cheat Sheets – Mac OS X</a></li>  <li class="file"><a href="/posts/2038387758/">Cheat Sheets – MySQL</a></li>  <li class="file"><a href="/posts/2920272111/">Cheat Sheets – Nodejs</a></li>  <li class="file"><a href="/posts/1362596080/">Cheat Sheets – PHP</a></li>  <li class="file"><a href="/posts/3167589601/">Cheat Sheets – Perl</a></li>  <li class="file"><a href="/posts/1053003126/">Cheat Sheets – Python</a></li>  <li class="file"><a href="/posts/1130312566/">Cheat Sheets – SQLite</a></li>  <li class="file"><a href="/posts/4169548678/">Cheat Sheets - Photoshop</a></li>  <li class="file"><a href="/posts/2789789845/">Cheat Sheets – jQuery</a></li>  <li class="file"><a href="/posts/3905631645/">Cheat sheets - Xcode</a></li>  <li class="file"><a href="/posts/3586350539/">Cheat sheets - Mac OS</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Project
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/467054247/">如何编写开源项目的README文档</a></li>  <li class="file"><a href="/posts/1755831586/">软件发布版本区别介绍</a></li>  </ul> 
                        </li>
                         </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                UI Design
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1907494021/">PS快捷键使用指南</a></li>  <li class="file"><a href="/posts/1525329016/">提高效率！24 个高手常用的 Sketch 技巧合集（附实用快捷键）</a></li>  </ul> 
                        </li>
                        
                        <li class="directory-open" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                back-end
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                Middle-ware
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Gogs
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/4076369309/">Gogs数据备份、恢复</a></li>  <li class="file"><a href="/posts/612684965/">私人Git服务器 -- gogs</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Jenkins
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2282359188/">jenkins密码重置</a></li>  <li class="file"><a href="/posts/388825549/">利用Jenkins持续集成iOS项目</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Logstash
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2615120416/">日志搜集处理框架Logstash-安装配置</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                MySQL
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2625460784/">MySQL延迟复制</a></li>  <li class="file"><a href="/posts/4284065059/">MySQL 调优/优化的 101 个建议</a></li>  <li class="file"><a href="/posts/2654174479/">分库分表 vs NewSQL数据库</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Nginx
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/524919010/">Nginx正向代理与Client设置代理上网</a></li>  <li class="file"><a href="/posts/3996389515/">Nginx配置跨域请求 Access-Control-Allow-Origin *</a></li>  <li class="file"><a href="/posts/1544228005/">高性能Web服务器 - Nginx配置详解</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                RabbitMQ
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3135873234/">RabbitMQ入门</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Redis
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/156114019/">Redis Stream应用案例</a></li>  <li class="file"><a href="/posts/2992538737/">redis.conf参数配置及解释</a></li>  <li class="file"><a href="/posts/2864310564/">深入分析Redis特点及应用场景</a></li>  <li class="file"><a href="/posts/3909951181/">Redis Manual</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Sentry
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1303728868/">错误日志收集平台 - Sentry(Redis+MySQL)</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Shadowsocks
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3154796955/">Vultr快速搭建SS科学上网</a></li>  </ul> 
                        </li>
                         </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                NodeJS
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2653381572/">NodeJS Package Manage Tool - NPM</a></li>  </ul> 
                        </li>
                        
                        <li class="directory-open" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                Python
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Build-in
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2858153934/">Python build-in functions - collections</a></li>  <li class="file"><a href="/posts/857250976/">Python build-in functions - List</a></li>  <li class="file"><a href="/posts/3208674450/">Python build-in module - os</a></li>  <li class="file"><a href="/posts/2434599799/">Python build-in functions</a></li>  <li class="file"><a href="/posts/5/">Python多线程和锁</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Configuration
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3568487154/">更改pip源至国内镜像 - 显著提升下载速度</a></li>  </ul> 
                        </li>
                        
                        <li class="directory-open" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Library
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file active"><a href="/posts/383305840/">Python Library - Flask SQLAlchemy</a></li>  <li class="file"><a href="/posts/55626181/">发布你自己的轮子 - PyPI打包上传实践</a></li>  <li class="file"><a href="/posts/4096440342/">Python Library - SQLAlchemy</a></li>  </ul> 
                        </li>
                         <li class="file"><a href="/posts/272954362/">sys.stdout.write实现Python控制台实时刷新打印</a></li>  </ul> 
                        </li>
                         </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                iOS Dev
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1054462359/">Apple Store上iOS App上架流程</a></li>  <li class="file"><a href="/posts/1098789015/">Xcode开发中Build与version区别/build自增设置/build随时间变化？</a></li>  </ul> 
                        </li>
                         </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });
        });
    </script>


    
        
    <div class="widget-wrap">
        <h3 class="widget-title"><span>recent</span></h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/4165683660/" class="thumbnail">
    
    
        <span style="background-image:url(https://www.jifu.io/images/2/rest-client-1024x357.png)" alt="REST Client 简单好用的接口测试辅助工具" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/OPS/">OPS</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/OPS/Editor/">Editor</a></p>
                            <p class="item-title"><a href="/posts/4165683660/" class="title">REST Client 简单好用的接口测试辅助工具</a></p>
                            <p class="item-date"><time datetime="2020-09-26T01:00:23.000Z" itemprop="datePublished">2020-09-26</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/581320548/" class="thumbnail">
    
    
        <span style="background-image:url(https://www.jifu.io/images/2/homebrew-social-card.png)" alt="Homebrew：让你从 Mac 切换到 Linux 更轻松" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/OPS/">OPS</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/OPS/MacOS/">MacOS</a></p>
                            <p class="item-title"><a href="/posts/581320548/" class="title">Homebrew：让你从 Mac 切换到 Linux 更轻松</a></p>
                            <p class="item-date"><time datetime="2020-09-25T12:03:23.000Z" itemprop="datePublished">2020-09-26</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/3895039994/" class="thumbnail">
    
    
        <span style="background-image:url(https://www.jifu.io/images/2/20190427135657.jpg)" alt="命令行信息截图工具 - ScreenFetch" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/OPS/">OPS</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/OPS/Others/">Others</a></p>
                            <p class="item-title"><a href="/posts/3895039994/" class="title">命令行信息截图工具 - ScreenFetch</a></p>
                            <p class="item-date"><time datetime="2020-08-11T05:17:21.000Z" itemprop="datePublished">2020-08-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/1413974522/" class="thumbnail">
    
    
        <span style="background-image:url(https://www.jifu.io/images/posts/1413974522/223592376156316015.jpg)" alt="用好这些隐藏「小开关」，让 Chrome 浏览器更好用" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/OPS/">OPS</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/OPS/Others/">Others</a></p>
                            <p class="item-title"><a href="/posts/1413974522/" class="title">用好这些隐藏「小开关」，让 Chrome 浏览器更好用</a></p>
                            <p class="item-date"><time datetime="2019-12-17T13:14:30.000Z" itemprop="datePublished">2019-12-18</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/4024224000/" class="thumbnail">
    
    
        <span style="background-image:url(https://www.jifu.io/images/2/20191116165053.png)" alt="Linux swap分区及作用详解" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/OPS/">OPS</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/OPS/Linux/">Linux</a></p>
                            <p class="item-title"><a href="/posts/4024224000/" class="title">Linux swap分区及作用详解</a></p>
                            <p class="item-date"><time datetime="2019-11-16T03:44:24.000Z" itemprop="datePublished">2019-11-16</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-back-end/Python/Library/python Library-Flask-sqlalchmey" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/back-end/">back-end</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/back-end/Python/">Python</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/back-end/Python/Library/">Library</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Library/">Library</a>, <a class="tag-link" href="/tags/Python/">Python</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/posts/383305840/">
            <time datetime="2018-07-12T12:13:15.000Z" itemprop="datePublished">2018-07-13</time>
        </a>
    </div>


                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            Python Library - Flask SQLAlchemy
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
                <div id="toc" class="toc-article">
                <strong class="toc-title">Catalogue</strong>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#What-is-Flask-SQLAlchemy"><span class="toc-number">1.</span> <span class="toc-text">What is Flask-SQLAlchemy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Example"><span class="toc-number">2.</span> <span class="toc-text">Example</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pip依赖包安装"><span class="toc-number">3.</span> <span class="toc-text">pip依赖包安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据库URL"><span class="toc-number">4.</span> <span class="toc-text">数据库URL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建迁移仓库"><span class="toc-number">5.</span> <span class="toc-text">创建迁移仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用一下命令创建数据库及迁移仓库"><span class="toc-number">5.1.</span> <span class="toc-text">使用一下命令创建数据库及迁移仓库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#定义数据模型"><span class="toc-number">6.</span> <span class="toc-text">定义数据模型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AQLAlchemy列类型"><span class="toc-number">7.</span> <span class="toc-text">AQLAlchemy列类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQLAlchemy列选项"><span class="toc-number">8.</span> <span class="toc-text">SQLAlchemy列选项</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#关系"><span class="toc-number">9.</span> <span class="toc-text">关系</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQLAlchemy关系选项"><span class="toc-number">10.</span> <span class="toc-text">SQLAlchemy关系选项</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQLAlchemy查询过滤器"><span class="toc-number">11.</span> <span class="toc-text">SQLAlchemy查询过滤器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQLAlchemy查询执行函数"><span class="toc-number">12.</span> <span class="toc-text">SQLAlchemy查询执行函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#操作实例"><span class="toc-number">13.</span> <span class="toc-text">操作实例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#连接数据库"><span class="toc-number">13.1.</span> <span class="toc-text">连接数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建所有表"><span class="toc-number">13.2.</span> <span class="toc-text">创建所有表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除所有表"><span class="toc-number">13.3.</span> <span class="toc-text">删除所有表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#插入行"><span class="toc-number">13.4.</span> <span class="toc-text">插入行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#插入单行"><span class="toc-number">13.4.1.</span> <span class="toc-text">插入单行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插入多行"><span class="toc-number">13.4.2.</span> <span class="toc-text">插入多行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新行"><span class="toc-number">13.5.</span> <span class="toc-text">更新行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除行"><span class="toc-number">13.6.</span> <span class="toc-text">删除行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询表"><span class="toc-number">13.7.</span> <span class="toc-text">查询表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查询表中全部数据"><span class="toc-number">13.7.1.</span> <span class="toc-text">查询表中全部数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#按照一个条件过滤数据记录-where"><span class="toc-number">13.7.2.</span> <span class="toc-text">按照一个条件过滤数据记录(where)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#按照两个条件过滤数据记录-where-and"><span class="toc-number">13.7.3.</span> <span class="toc-text">按照两个条件过滤数据记录(where and)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#聚合-count"><span class="toc-number">13.7.4.</span> <span class="toc-text">聚合(count)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#求和-sum"><span class="toc-number">13.7.5.</span> <span class="toc-text">求和(sum)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#平均数-avg"><span class="toc-number">13.7.6.</span> <span class="toc-text">平均数(avg)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#排序-order-by"><span class="toc-number">13.7.7.</span> <span class="toc-text">排序(order by)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分组-group-by"><span class="toc-number">13.7.8.</span> <span class="toc-text">分组(group by)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#限制-limit"><span class="toc-number">13.7.9.</span> <span class="toc-text">限制(limit)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#将Flask-SQLAlchemy的查询语句转换为SQL"><span class="toc-number">14.</span> <span class="toc-text">将Flask-SQLAlchemy的查询语句转换为SQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">15.</span> <span class="toc-text">参考资料</span></a></li></ol>
                </div>
            
        
        
            <h1 id="What-is-Flask-SQLAlchemy"><a href="#What-is-Flask-SQLAlchemy" class="headerlink" title="What is Flask-SQLAlchemy"></a>What is Flask-SQLAlchemy</h1><p>Flask-SQLAlchemy is a Flask microframework extension which adds support for the SQLAlchemy SQL toolkit/ORM.</p>
<p><img src="https://www.jifu.io/images/2/maxresdefault.jpg" alt=""></p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><pre class="line-numbers language-python"><code class="language-python">
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Fianna'</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SQLALCHEMY_DATABASE_URI'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'mysql://user:password@host:port/dbname'</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Role</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">'roles'</span>
    id <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> server_default<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'&lt;Role %r>'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">'users'</span>
    id <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> server_default<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    role_id <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> server_default<span class="token operator">=</span><span class="token string">'0'</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'&lt;User %r,Role id %r>'</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>username<span class="token punctuation">,</span>self<span class="token punctuation">.</span>role_id<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<a id="more"></a>
<h1 id="pip依赖包安装"><a href="#pip依赖包安装" class="headerlink" title="pip依赖包安装"></a>pip依赖包安装</h1><p><code>pip install mysql-python</code><br><code>pip install flask-sqlalchemy</code></p>
<h1 id="数据库URL"><a href="#数据库URL" class="headerlink" title="数据库URL"></a>数据库URL</h1><table>
<thead>
<tr>
<th>数据库引擎</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySQL</td>
<td>mysql://username:password@hostname/database</td>
</tr>
<tr>
<td>Postgres</td>
<td>postgresql://username:password@hostname/database</td>
</tr>
<tr>
<td>SQLite(Unix)</td>
<td>sqlite:////absolute/path/database</td>
</tr>
<tr>
<td>SQLite(Windows)</td>
<td>sqlite:///c:/absolute/path/database</td>
</tr>
</tbody>
</table>
<p>在这些URL中，<code>hostname</code>表示MySQL服务器所在的主机，可以是本地主机（localhost），也可以是远程服务器。数据服务器上可以托管多个数据库，因此database表示要是使用的数据库名。如果数据库需要进行认证，username和password表示数据库用户和密码。</p>
<p>程序中使用的数据库URL必须保存到Flask配置对象config.py的<code>SQLALCHEMY_DATABASE_URI</code>键中。另外一个很有用的选项，即<code>SQLALCHEMY_COMMIT_ON_TEARDOWN</code>键，将其设置为<code>True</code>时，每次请求结束后都会自动提交数据库中的变动。</p>
<h1 id="创建迁移仓库"><a href="#创建迁移仓库" class="headerlink" title="创建迁移仓库"></a>创建迁移仓库</h1><p>定义好数据模型之后，就应该设计数据库了，不管你用mysql还是sqlite，flask-SQLAlchemy和flask-Migrate会根据数据模型自动创建数据库。 为了导出数据库迁移命令，flask-Migrate提供了一个MigrateCommand类，可附加在flask-script的manage对象上。设置manage.py。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">from</span> flask<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>migrate <span class="token keyword">import</span> Migrate<span class="token punctuation">,</span> MigrateCommand

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

migrate <span class="token operator">=</span> Migrate<span class="token punctuation">(</span>app<span class="token operator">=</span>app<span class="token punctuation">,</span> db<span class="token operator">=</span>db<span class="token punctuation">)</span>
manager<span class="token punctuation">.</span>add_command<span class="token punctuation">(</span><span class="token string">'db'</span><span class="token punctuation">,</span> MigrateCommand<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="使用一下命令创建数据库及迁移仓库"><a href="#使用一下命令创建数据库及迁移仓库" class="headerlink" title="使用一下命令创建数据库及迁移仓库"></a>使用一下命令创建数据库及迁移仓库</h2><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">(</span>flask<span class="token punctuation">)</span>$ python manage.py db init
<span class="token punctuation">(</span>flask<span class="token punctuation">)</span>$ python manage.py db migrate -m <span class="token string">"initial migration"</span>
<span class="token punctuation">(</span>flask<span class="token punctuation">)</span>$ python manage.py db upgrade
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>注意事项，虽然flask-migrate提供了downgrade()函数，可以将改动删除。但是建议大家不要随便使用。如果你觉得数据库设计得有问题，建议你删除相关数据库设计，重新再来。</p>
<h1 id="定义数据模型"><a href="#定义数据模型" class="headerlink" title="定义数据模型"></a>定义数据模型</h1><p>和所有的应用一样，我们先设计简单的用户和权限模型。模型这个术语表示程序中使用的持久化实体。在 ORM 中,模型一般是一个 Python 类,类中的属性对应数据库表中的列。 示例 2-1 app/models.py: 定义 Role 和 User 模型</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Role</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">'roles'</span>
    id <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'&lt;Role %r>'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">'users'</span>
    id <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'&lt;User %r>'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>username
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>类变量<strong>tablename</strong>定义在数据库中使用的表名。其余的类变量都是该模型的属性，被定义为db.Column类的示例。</p>
<p>db.Column类构造函数的第一个参数是数据库列和模型属性的类型。下表列出了一些最常用的列类型以及在模型中使用的Python类型。</p>
<h1 id="AQLAlchemy列类型"><a href="#AQLAlchemy列类型" class="headerlink" title="AQLAlchemy列类型"></a>AQLAlchemy列类型</h1><table>
<thead>
<tr>
<th>类型名</th>
<th>Python类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Integer</td>
<td>int</td>
<td>普通整数，一般是32位</td>
</tr>
<tr>
<td>SmallInteger</td>
<td>int</td>
<td>取值范围小的整数，一般是16位</td>
</tr>
<tr>
<td>BigInteger</td>
<td>int或long</td>
<td>不限制精度的整数</td>
</tr>
<tr>
<td>Float</td>
<td>float</td>
<td>浮点数</td>
</tr>
<tr>
<td>Numeric</td>
<td>decimal.Decimal</td>
<td>定点数</td>
</tr>
<tr>
<td>String</td>
<td>str</td>
<td>变长字符串</td>
</tr>
<tr>
<td>Text</td>
<td>str</td>
<td>变长字符串，对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td>Unicode</td>
<td>unicode</td>
<td>变长Unicode字符串</td>
</tr>
<tr>
<td>UnicodeText</td>
<td>unicode</td>
<td>变长Unicode字符串,对较长或不限长度的字符床做了优化</td>
</tr>
<tr>
<td>Boolean</td>
<td>bool</td>
<td>布尔值</td>
</tr>
<tr>
<td>Date</td>
<td>datetime.date</td>
<td>日期</td>
</tr>
<tr>
<td>Time</td>
<td>datetime.time</td>
<td>时间</td>
</tr>
<tr>
<td>DateTime</td>
<td>datetime.datetime</td>
<td>日期和时间</td>
</tr>
<tr>
<td>Interval</td>
<td>datetime.timedeta</td>
<td>时间间隔</td>
</tr>
<tr>
<td>Enum</td>
<td>str</td>
<td>一组字符串</td>
</tr>
<tr>
<td>PickleType</td>
<td>任何Python对象</td>
<td>自动化使用Pickle序列化</td>
</tr>
<tr>
<td>LargeBinary</td>
<td>str</td>
<td>二进制文件</td>
</tr>
</tbody>
</table>
<h1 id="SQLAlchemy列选项"><a href="#SQLAlchemy列选项" class="headerlink" title="SQLAlchemy列选项"></a>SQLAlchemy列选项</h1><table>
<thead>
<tr>
<th>选项名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>primary_key</td>
<td>如果设为True，这列就是表的主键</td>
</tr>
<tr>
<td>unique</td>
<td>如果设为True，这列不允许出现重复</td>
</tr>
<tr>
<td>index</td>
<td>如果设为True，为这列创建索引，提升查询效率</td>
</tr>
<tr>
<td>nullable</td>
<td>如果设为True，这列允许使用空值；如果设为False，这列不允许使用空值</td>
</tr>
<tr>
<td>default</td>
<td>为这列定义默认值</td>
</tr>
</tbody>
</table>
<h1 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h1><pre class="line-numbers language-python"><code class="language-python">app<span class="token operator">/</span>models<span class="token punctuation">.</span>py 一对多关系模型

<span class="token keyword">class</span> <span class="token class-name">Role</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># ...</span>
    users <span class="token operator">=</span> db<span class="token punctuation">.</span>relationship<span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> backref<span class="token operator">=</span><span class="token string">'role'</span><span class="token punctuation">,</span> lazy<span class="token operator">=</span><span class="token string">'dynamic'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>UserMixin<span class="token punctuation">,</span> db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># ...</span>
    role_id <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> db<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">'roles.id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="SQLAlchemy关系选项"><a href="#SQLAlchemy关系选项" class="headerlink" title="SQLAlchemy关系选项"></a>SQLAlchemy关系选项</h1><table>
<thead>
<tr>
<th>选项名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>backref</td>
<td>在关系的另一个模型中添加反向引用</td>
</tr>
<tr>
<td>primaryjoin</td>
<td>明确指定两个模型之间使用的联结条件。只在模棱两可的关系中需要指定</td>
</tr>
<tr>
<td>lazy</td>
<td>指定如何加载相关记录。可选值有select（首次访问时按需加载）、immediate（源对象加载后加载）、joined（加载记录，但使用联结）、subquery（立即加载，但使用子查询），noload（永不加载）和dynamic（不加载记录，但提供加载记录的查询）</td>
</tr>
<tr>
<td>uselist</td>
<td>如果设为False，不使用列表，而使用标量值</td>
</tr>
<tr>
<td>order_by</td>
<td>指定关系中记录的排序方式</td>
</tr>
<tr>
<td>secondary</td>
<td>指定多对多关系表的名字</td>
</tr>
<tr>
<td>secondaryjoin</td>
<td>SQLAlchemy无法自行决定时，指定多对多关系中的二级联结条件</td>
</tr>
</tbody>
</table>
<p>除 一对多 关系之外，还有几种其它的关系类型。一对一 关系可以用前面介绍的 一对多 关系表示，但调用db.relationship()时要把uselist设为False，把“多”变成“一”。 多对一 关系也可使用 一对多 表示，对调两个表即可，或者把外键和db.relationship()都放在“多”这一侧。最复杂的关系是 多对多 ，需要用到第三张表，这个表称为 关系表。</p>
<h1 id="SQLAlchemy查询过滤器"><a href="#SQLAlchemy查询过滤器" class="headerlink" title="SQLAlchemy查询过滤器"></a>SQLAlchemy查询过滤器</h1><table>
<thead>
<tr>
<th>过滤器</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>filter()</td>
<td>把过滤器添加到原查询上，返回一个新查询</td>
</tr>
<tr>
<td>filter_by()</td>
<td>把等值过滤器添加到原查询上，返回一个新查询</td>
</tr>
<tr>
<td>limit()</td>
<td>使用指定的值限制原查询返回的结果数量，返回一个新查询</td>
</tr>
<tr>
<td>offset()</td>
<td>偏移原查询返回的结果，返回一个新查询</td>
</tr>
<tr>
<td>order_by()</td>
<td>根据指定条件对原查询结果进行排序，返回一个新查询</td>
</tr>
<tr>
<td>group_by()</td>
<td>根据指定条件对原查询进行分组，返回一个新查询</td>
</tr>
</tbody>
</table>
<p>在查询上应用指定的过滤器后，通过调用all()执行查询，以列表形式返回结果。除了all()，还有其它方法能触发查询执行。</p>
<h1 id="SQLAlchemy查询执行函数"><a href="#SQLAlchemy查询执行函数" class="headerlink" title="SQLAlchemy查询执行函数"></a>SQLAlchemy查询执行函数</h1><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>all()</td>
<td>以列表形式返回查询的所有结果</td>
</tr>
<tr>
<td>first()</td>
<td>返回查询的第一个结果，如果没有结果，返回None</td>
</tr>
<tr>
<td>first_or_404()</td>
<td>返回查询的第一个结果，如果没有结果，则终止请求，返回404错误响应</td>
</tr>
<tr>
<td>get()</td>
<td>返回指定主键对应的行，如果没有对应的行，返回None</td>
</tr>
<tr>
<td>get_or_404()</td>
<td>返回指定主键对应的行，如果没有对应的行，则终止请求，返回404错误响应</td>
</tr>
<tr>
<td>count()</td>
<td>返回查询结果的数量</td>
</tr>
<tr>
<td>paginate()</td>
<td>返回一个Paginate对象，它包含指定范围内的结果。</td>
</tr>
</tbody>
</table>
<h1 id="操作实例"><a href="#操作实例" class="headerlink" title="操作实例"></a>操作实例</h1><h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><p><code>app.config[&#39;SQLALCHEMY_DATABASE_URI&#39;] = &#39;mysql://user:password@host:port/dbname&#39;</code></p>
<h2 id="创建所有表"><a href="#创建所有表" class="headerlink" title="创建所有表"></a>创建所有表</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> hello <span class="token keyword">import</span> db<span class="token punctuation">,</span>Role<span class="token punctuation">,</span>User
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="删除所有表"><a href="#删除所有表" class="headerlink" title="删除所有表"></a>删除所有表</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> hello <span class="token keyword">import</span> db<span class="token punctuation">,</span>Role<span class="token punctuation">,</span>User
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>drop_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="插入行"><a href="#插入行" class="headerlink" title="插入行"></a>插入行</h2><h3 id="插入单行"><a href="#插入单行" class="headerlink" title="插入单行"></a>插入单行</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> hello <span class="token keyword">import</span> db<span class="token punctuation">,</span>Role<span class="token punctuation">,</span>User
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Role<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Admin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Role<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Moderator'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Role<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="插入多行"><a href="#插入多行" class="headerlink" title="插入多行"></a>插入多行</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> hello <span class="token keyword">import</span> db<span class="token punctuation">,</span>Role<span class="token punctuation">,</span>User
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add_all<span class="token punctuation">(</span><span class="token punctuation">[</span>User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'john'</span><span class="token punctuation">,</span>role_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'susan'</span><span class="token punctuation">,</span>role_id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'david'</span><span class="token punctuation">,</span>role_id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="更新行"><a href="#更新行" class="headerlink" title="更新行"></a>更新行</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> hello <span class="token keyword">import</span> db<span class="token punctuation">,</span>Role<span class="token punctuation">,</span>User
<span class="token operator">>></span><span class="token operator">></span> admin <span class="token operator">=</span> Role<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Admin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> admin<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'Administrator'</span>
<span class="token operator">>></span><span class="token operator">></span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="删除行"><a href="#删除行" class="headerlink" title="删除行"></a>删除行</h2><p><code>`</code>python hello.py shell</p>
<blockquote>
<blockquote>
<blockquote>
<p>from hello import db,Role,User<br>mod = Role.query.filter_by(name=’Moderator’).first()<br>db.session.delete(mod)<br>db.session.commit()<br><code>`</code></p>
</blockquote>
</blockquote>
</blockquote>
<h2 id="查询表"><a href="#查询表" class="headerlink" title="查询表"></a>查询表</h2><h3 id="查询表中全部数据"><a href="#查询表中全部数据" class="headerlink" title="查询表中全部数据"></a>查询表中全部数据</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 注意，此处的查询结果完全取决于代码示例中的</span>
<span class="token comment" spellcheck="true"># def __repr__(self)</span>
<span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token operator">>></span><span class="token operator">></span> Role.query.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>Role u<span class="token string">'Administrator'</span><span class="token operator">></span>, <span class="token operator">&lt;</span>Role u<span class="token string">'User'</span><span class="token operator">></span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'john'</span>,Role <span class="token function">id</span> 1L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="按照一个条件过滤数据记录-where"><a href="#按照一个条件过滤数据记录-where" class="headerlink" title="按照一个条件过滤数据记录(where)"></a>按照一个条件过滤数据记录(where)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token operator">>></span><span class="token operator">></span> Role.query.filter_by<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Administrator'</span><span class="token punctuation">)</span>.first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>Role u<span class="token string">'Administrator'</span><span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> User.query.filter_by<span class="token punctuation">(</span>role_id<span class="token operator">=</span>3<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.filter_by<span class="token punctuation">(</span>role_id<span class="token operator">=</span>3<span class="token punctuation">)</span>.first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="按照两个条件过滤数据记录-where-and"><a href="#按照两个条件过滤数据记录-where-and" class="headerlink" title="按照两个条件过滤数据记录(where and)"></a>按照两个条件过滤数据记录(where and)</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token operator">>></span><span class="token operator">></span> User.query.filter_by<span class="token punctuation">(</span>role_id<span class="token operator">=</span>3,username<span class="token operator">=</span><span class="token string">'susan'</span><span class="token punctuation">)</span>.first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>
<span class="token operator">>></span><span class="token operator">></span> User.query.filter_by<span class="token punctuation">(</span>role_id<span class="token operator">=</span>3,username<span class="token operator">=</span><span class="token string">'susan'</span><span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="聚合-count"><a href="#聚合-count" class="headerlink" title="聚合(count)"></a>聚合(count)</h3><pre class="line-numbers language-bash"><code class="language-bash">python hello.py shell
<span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token operator">>></span><span class="token operator">></span> User.query.filter_by<span class="token punctuation">(</span>role_id<span class="token operator">=</span>3,username<span class="token operator">=</span><span class="token string">'susan'</span><span class="token punctuation">)</span>.count<span class="token punctuation">(</span><span class="token punctuation">)</span>
1L
<span class="token operator">>></span><span class="token operator">></span> User.query.filter_by<span class="token punctuation">(</span>role_id<span class="token operator">=</span>3<span class="token punctuation">)</span>.count<span class="token punctuation">(</span><span class="token punctuation">)</span>
2L
<span class="token operator">>></span><span class="token operator">></span> User.query.count<span class="token punctuation">(</span><span class="token punctuation">)</span>
3L
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="求和-sum"><a href="#求和-sum" class="headerlink" title="求和(sum)"></a>求和(sum)</h3><pre class="line-numbers language-bash"><code class="language-bash">python hello.py shell
<span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token operator">>></span><span class="token operator">></span> from sqlalchemy.sql <span class="token function">import</span> func
<span class="token operator">>></span><span class="token operator">></span> User.query.with_entities<span class="token punctuation">(</span>func.sum<span class="token punctuation">(</span>User.id<span class="token punctuation">))</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span>Decimal<span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">)</span>,<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.with_entities<span class="token punctuation">(</span>func.sum<span class="token punctuation">(</span>User.role_id<span class="token punctuation">))</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span>Decimal<span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span>,<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="平均数-avg"><a href="#平均数-avg" class="headerlink" title="平均数(avg)"></a>平均数(avg)</h3><pre class="line-numbers language-bash"><code class="language-bash">python
<span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token operator">>></span><span class="token operator">></span> from sqlalchemy.sql <span class="token function">import</span> func
<span class="token operator">>></span><span class="token operator">></span> User.query.with_entities<span class="token punctuation">(</span>func.avg<span class="token punctuation">(</span>User.role_id<span class="token punctuation">))</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span>Decimal<span class="token punctuation">(</span><span class="token string">'2.3333'</span><span class="token punctuation">)</span>,<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.with_entities<span class="token punctuation">(</span>func.avg<span class="token punctuation">(</span>User.id<span class="token punctuation">))</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span>Decimal<span class="token punctuation">(</span><span class="token string">'2.0000'</span><span class="token punctuation">)</span>,<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="排序-order-by"><a href="#排序-order-by" class="headerlink" title="排序(order by)"></a>排序(order by)</h3><pre class="line-numbers language-bash"><code class="language-bash">python
<span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token comment" spellcheck="true"># 升序(asc)</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.order_by<span class="token punctuation">(</span>User.role_id<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'john'</span>,Role <span class="token function">id</span> 1L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 降序(desc)</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.order_by<span class="token punctuation">(</span>User.role_id.desc<span class="token punctuation">(</span><span class="token punctuation">))</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'john'</span>,Role <span class="token function">id</span> 1L<span class="token operator">></span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="分组-group-by"><a href="#分组-group-by" class="headerlink" title="分组(group by)"></a>分组(group by)</h3><pre class="line-numbers language-bash"><code class="language-bash">python hello.py shell
<span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token operator">>></span><span class="token operator">></span> User.query.group_by<span class="token punctuation">(</span>User.role_id<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'john'</span>,Role <span class="token function">id</span> 1L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="限制-limit"><a href="#限制-limit" class="headerlink" title="限制(limit)"></a>限制(limit)</h3><pre class="line-numbers language-bash"><code class="language-bash">python
<span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token operator">>></span><span class="token operator">></span> User.query.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'john'</span>,Role <span class="token function">id</span> 1L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># limit 1</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.limit<span class="token punctuation">(</span>1<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'john'</span>,Role <span class="token function">id</span> 1L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># limit 2,1</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.limit<span class="token punctuation">(</span>1<span class="token punctuation">)</span>.offset<span class="token punctuation">(</span>2<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.filter_by<span class="token punctuation">(</span>role_id<span class="token operator">=</span>3<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># limit 1</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.filter_by<span class="token punctuation">(</span>role_id<span class="token operator">=</span>3<span class="token punctuation">)</span>.limit<span class="token punctuation">(</span>1<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># limit 1,1</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.filter_by<span class="token punctuation">(</span>role_id<span class="token operator">=</span>3<span class="token punctuation">)</span>.limit<span class="token punctuation">(</span>1<span class="token punctuation">)</span>.offset<span class="token punctuation">(</span>1<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="将Flask-SQLAlchemy的查询语句转换为SQL"><a href="#将Flask-SQLAlchemy的查询语句转换为SQL" class="headerlink" title="将Flask-SQLAlchemy的查询语句转换为SQL"></a>将Flask-SQLAlchemy的查询语句转换为SQL</h1><pre class="line-numbers language-bash"><code class="language-bash">python
<span class="token operator">>></span><span class="token operator">></span> from hello <span class="token function">import</span> db,Role,User
<span class="token operator">>></span><span class="token operator">></span> User.query.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'john'</span>,Role <span class="token function">id</span> 1L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'susan'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span>, <span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> str<span class="token punctuation">(</span>User.query<span class="token punctuation">)</span>
<span class="token string">'SELECT users.id AS users_id, users.username AS users_username, users.role_id AS users_role_id \nFROM users'</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.limit<span class="token punctuation">(</span>1<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'john'</span>,Role <span class="token function">id</span> 1L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> str<span class="token punctuation">(</span>User.query.limit<span class="token punctuation">(</span>1<span class="token punctuation">))</span>
<span class="token string">'SELECT users.id AS users_id, users.username AS users_username, users.role_id AS users_role_id \nFROM users \n LIMIT %s'</span>
<span class="token operator">>></span><span class="token operator">></span> User.query.limit<span class="token punctuation">(</span>1<span class="token punctuation">)</span>.offset<span class="token punctuation">(</span>2<span class="token punctuation">)</span>.all<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>User u<span class="token string">'david'</span>,Role <span class="token function">id</span> 3L<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> str<span class="token punctuation">(</span>User.query.limit<span class="token punctuation">(</span>1<span class="token punctuation">)</span>.offset<span class="token punctuation">(</span>2<span class="token punctuation">))</span>
<span class="token string">'SELECT users.id AS users_id, users.username AS users_username, users.role_id AS users_role_id \nFROM users \n LIMIT %s, %s'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>-<a href="https://www.os373.cn/article/7" target="_blank" rel="noopener">第七章 使用 Flask 扩展管理数据库</a><br>-<a href="https://wing324.github.io/%2F2017%2F02%2F25%2F使用flask-sqlalchemy玩转MySQL%2F" target="_blank" rel="noopener">使用flask-sqlalchemy玩转MySQL</a></p>
</blockquote>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>


    
<nav id="article-nav">
    
        <a href="/posts/3154796955/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    Vultr快速搭建SS科学上网
                
            </div>
        </a>
    
    
        <a href="/posts/4096440342/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">Python Library - SQLAlchemy</div>
        </a>
    
</nav>





    
    




<!-- baidu url auto push script -->
<script type="text/javascript">
    !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
</script>     

<head><meta name="generator" content="Hexo 3.9.0">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<link rel="stylesheet" href="/css/prism-duotone-light.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
<body>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: '8kLhebBkVygl1MhVcQx9dnBP-gzGzoHsz',
            appKey: 'hrctlOb6RQBWjjwTJ9fVjb91'
        })
    </script>
</body>


</section>
        </div>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            <a href="https://www.jifu.io">
            Ji Fu &copy; 2020
            </a>
            <br> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme - <a href="https://github.com/zthxxx/hexo-theme-Wikitten">wikitten</a>
            <br> 您是  jifu'wiki 的第<span id="busuanzi_value_site_uv"></span>个小伙伴
            <br>
                本站总访问量<span id="busuanzi_value_site_pv"></span>次
                本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </div>
    </div>
</footer>



        

    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>