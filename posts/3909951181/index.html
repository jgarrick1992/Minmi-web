<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    <title>Redis Manual | JiFu&#39;s Wiki</title>
    
    
        <meta name="keywords" content="中间件,Middleware,redis,manual">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Redis是什么redis（REmote DIctionary Server）是一个开源的、使用C语言编写的、支持网络交互的、基于内存也可持久化的高性能Key-Value数据库。 redis的官网地址，非常好记，是redis.io。（特意查了一下，域名后缀io属于国家域名，是british Indian Ocean territory，即英属印度洋领地） 目前，Vmware在资助着redis项目">
<meta name="keywords" content="中间件,Middleware,redis,manual">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis Manual">
<meta property="og:url" content="http://www.jifu.io/posts/3909951181/index.html">
<meta property="og:site_name" content="JiFu&#39;s Wiki">
<meta property="og:description" content="Redis是什么redis（REmote DIctionary Server）是一个开源的、使用C语言编写的、支持网络交互的、基于内存也可持久化的高性能Key-Value数据库。 redis的官网地址，非常好记，是redis.io。（特意查了一下，域名后缀io属于国家域名，是british Indian Ocean territory，即英属印度洋领地） 目前，Vmware在资助着redis项目">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://www.jifu.io/images/2/Untitled-1.jpg">
<meta property="og:updated_time" content="2020-08-11T05:17:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Redis Manual">
<meta name="twitter:description" content="Redis是什么redis（REmote DIctionary Server）是一个开源的、使用C语言编写的、支持网络交互的、基于内存也可持久化的高性能Key-Value数据库。 redis的官网地址，非常好记，是redis.io。（特意查了一下，域名后缀io属于国家域名，是british Indian Ocean territory，即英属印度洋领地） 目前，Vmware在资助着redis项目">
<meta name="twitter:image" content="https://www.jifu.io/images/2/Untitled-1.jpg">
    

    
        <link rel="alternate" href="/atom.xml" title="JiFu&#39;s Wiki" type="application/atom+xml">
    

    
        <link rel="icon" href="/favicon.ico">
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">
    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    
        <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?efa1eb5f56c438a850a0f60609fd7755";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    


<link rel="stylesheet" href="/css/prism-duotone-light.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
</html>
<body>
    <div id="container">
        <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

<header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">JiFu&#39;s Wiki</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id='categories'>
        <h3 class="widget-title">
            <span>分类</span>
            &nbsp;
            <a id='allExpand' href="#">
                <i class="fa fa-angle-double-up fa-2x"></i>
            </a>
        </h3>

        
        
         <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Android Development
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1797699998/">深入了解 gradle 和 maven 的区别</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Design
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1907494021/">PS快捷键使用指南</a></li>  <li class="file"><a href="/posts/729727978/">快速改善用户界面的10个技巧</a></li>  <li class="file"><a href="/posts/1525329016/">提高效率！24 个高手常用的 Sketch 技巧合集（附实用快捷键）</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                HR
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3142539384/">HR常用的招聘邮件模板</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Hardware
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3904818761/">MacBook十年进化史</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                OPS
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Docker
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1245529498/">Docker学习笔记</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Editor
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/4165683660/">REST Client 简单好用的接口测试辅助工具</a></li>  <li class="file"><a href="/posts/151598530/">VScdoe error:Could not create temporary directory Permission denied</a></li>  <li class="file"><a href="/posts/4167799419/">Build personal development editor with vscode</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                Linux
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                CentOS
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1867760035/">CentOS7编译安装VIM8</a></li>  <li class="file"><a href="/posts/1153610031/">centos7修改启动内核，删除无用内核</a></li>  <li class="file"><a href="/posts/4057676473/">yum提示Error: rpmdb open failed的解决方案</a></li>  <li class="file"><a href="/posts/920993072/">CentOS update Ruby</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                System Service
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/4024224000/">Linux swap分区及作用详解</a></li>  <li class="file"><a href="/posts/797311580/">服务管理工具 - systemctl</a></li>  <li class="file"><a href="/posts/709002730/">使用 systemctl 添加自定义服务</a></li>  <li class="file"><a href="/posts/55221137/">防火墙工具 - firewalld</a></li>  </ul> 
                        </li>
                         <li class="file"><a href="/posts/3897848060/">Mac使用SSH登录Google Cloud Platform</a></li>  <li class="file"><a href="/posts/4070386720/">Linux系统目录结构及详细说明</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                MacOS
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3746871293/">Charles从入门到精通</a></li>  <li class="file"><a href="/posts/581320548/">Homebrew：让你从 Mac 切换到 Linux 更轻松</a></li>  <li class="file"><a href="/posts/2776773816/">Mac OS X设置SMB进行文件共享</a></li>  <li class="file"><a href="/posts/3837318570/">Mac VSCode 禁用GPU加速</a></li>  <li class="file"><a href="/posts/4147446761/">Mac 时间机器 Time Machine 备份速度太慢的解决方法 (加速备份命令)</a></li>  <li class="file"><a href="/posts/1208074722/">Mac重置系统管理控制器SMC</a></li>  <li class="file"><a href="/posts/294187676/">Mac版迅雷优化,删除无用插件</a></li>  <li class="file"><a href="/posts/582618556/">Mac的最大连接数限制和端口的相关参数的设置</a></li>  <li class="file"><a href="/posts/2733308530/">Mac定时任务-利用launchctl定时启动任务</a></li>  <li class="file"><a href="/posts/4001059579/">Compiling PyQt5 for Python2.7 on Mac OS</a></li>  <li class="file"><a href="/posts/1883980072/">Mac OS系统加速：干掉那些「炫酷」的动画</a></li>  <li class="file"><a href="/posts/1070186292/">SafariBookmarksSyncAgent意外退出解决方法</a></li>  <li class="file"><a href="/posts/2652542772/">macOS 下 FFmpeg 视频转码入门及进阶使用心得</a></li>  <li class="file"><a href="/posts/2768996547/">一览Mac OS 图形界面的发展史</a></li>  <li class="file"><a href="/posts/1623087360/">修复破解Mac应用启动时闪退（原因是由于苹果移除了TNT证书）</a></li>  <li class="file"><a href="/posts/1525358532/">在 M1 芯片 Mac 上使用 Homebrew</a></li>  <li class="file"><a href="/posts/3807466731/">如何彻底和CrossOver说GoodBye</a></li>  <li class="file"><a href="/posts/3366946474/">Mac高效使用技巧</a></li>  <li class="file"><a href="/posts/646546052/">如何查看 macOS 系统日志，辅助排除应用程序和系统故障</a></li>  <li class="file"><a href="/posts/4263562837/">一个惊人快速的终端录像工具，也能录制 VSCode 和 Chrome 窗口</a></li>  <li class="file"><a href="/posts/3920589165/">如何重置Mac上的NVRAM</a></li>  <li class="file"><a href="/posts/647907268/">苹果M1芯片Macbook安装win10</a></li>  <li class="file"><a href="/posts/1207571108/">强制退出Mac程序的六种方法</a></li>  <li class="file"><a href="/posts/3653564083/">苹果 Mac 重置 SMC、NVRAM、PRAM 方法教程 - 解决 macOS 卡顿或无法启动</a></li>  <li class="file"><a href="/posts/3430780623/">解决Mac修改DNS卡死-命令行修改Mac OS系统DNS设置</a></li>  <li class="file"><a href="/posts/558776221/">解决“Mac应用”已损坏，无法打开的问题</a></li>  <li class="file"><a href="/posts/662287335/">MACOS BOOT CAMP – THE STARTUP DISK DOES NOT HAVE ENOUGH SPACE TO BE PARTITIONED</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Others
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2867836530/">Axel:命令行下轻量级多线程下载程序</a></li>  <li class="file"><a href="/posts/3101956195/">Git中.gitignore无效的解决办法</a></li>  <li class="file"><a href="/posts/3784546227/">Git忽略提交规则 - .gitignore配置总结</a></li>  <li class="file"><a href="/posts/3413649842/">Linux实用工具</a></li>  <li class="file"><a href="/posts/1073812833/">linux下测试磁盘的读写IO速度(IO物理测速)</a></li>  <li class="file"><a href="/posts/3895039994/">命令行信息截图工具 - ScreenFetch</a></li>  <li class="file"><a href="/posts/760033837/">平铺式窗口管理器 - Awesome</a></li>  <li class="file"><a href="/posts/1413974522/">用好这些隐藏「小开关」，让 Chrome 浏览器更好用</a></li>  <li class="file"><a href="/posts/2006196850/">私有化TM备份与共享服务器 - Netatalk</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Vim
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/258379777/">VIM下使用Vundle搭建python开发环境</a></li>  <li class="file"><a href="/posts/3374749959/">Vim快捷键使用总结</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Windows
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/913943227/">解决EXCEL按上下左右键不是单元格移动的问题</a></li>  <li class="file"><a href="/posts/3426016246/">利用windows内置工具测试硬盘速度 - winsat</a></li>  <li class="file"><a href="/posts/3669230936/">为远程桌面启用Windows防火墙例外</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Wordpress
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1067246247/">WordPress启用memcached动态缓存以及报错解决</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                command
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3200906184/">find命令快速技巧：如何定位一个文件</a></li>  <li class="file"><a href="/posts/2407250830/">history命令设置linux查看历史命令显示执行时间</a></li>  <li class="file"><a href="/posts/3403344661/">定时任务Crontab命令详解</a></li>  <li class="file"><a href="/posts/3241041753/">通过编写 chroot 来认识 chroot 发挥的作用和它带来的好处</a></li>  </ul> 
                        </li>
                         <li class="file"><a href="/posts/404814820/">DevOps简介</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                Soft engineering
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Algorithm
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1453950584/">8大排序算法图文讲解</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Architecture
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2097636152/">工作两三年了，整不明白架构图都画啥？</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Cheat Sheets
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2623330927/">Cheat Sheets - PostgreSQL</a></li>  <li class="file"><a href="/posts/4169548679/">Cheat Sheets - .NET</a></li>  <li class="file"><a href="/posts/3048024619/">Cheat Sheets - Django Reference Sheet</a></li>  <li class="file"><a href="/posts/3433268710/">Cheat Sheets - Shell Script</a></li>  <li class="file"><a href="/posts/3327139081/">Cheat Sheets – C++</a></li>  <li class="file"><a href="/posts/305297407/">Cheat Sheets – C</a></li>  <li class="file"><a href="/posts/2993634676/">Cheat Sheets - Git</a></li>  <li class="file"><a href="/posts/2137528313/">Cheat Sheets – CSS</a></li>  <li class="file"><a href="/posts/59285358/">Cheat Sheets – HTML and XHTML</a></li>  <li class="file"><a href="/posts/3766000533/">Cheat Sheets – HTTP</a></li>  <li class="file"><a href="/posts/2663199359/">Cheat Sheets – Java</a></li>  <li class="file"><a href="/posts/982990798/">Cheat Sheets – Linux</a></li>  <li class="file"><a href="/posts/316669616/">Cheat Sheets – Mac OS X</a></li>  <li class="file"><a href="/posts/2038387758/">Cheat Sheets – MySQL</a></li>  <li class="file"><a href="/posts/2920272111/">Cheat Sheets – Nodejs</a></li>  <li class="file"><a href="/posts/1362596080/">Cheat Sheets – PHP</a></li>  <li class="file"><a href="/posts/3167589601/">Cheat Sheets – Perl</a></li>  <li class="file"><a href="/posts/1053003126/">Cheat Sheets – Python</a></li>  <li class="file"><a href="/posts/1130312566/">Cheat Sheets – SQLite</a></li>  <li class="file"><a href="/posts/2789789845/">Cheat Sheets – jQuery</a></li>  <li class="file"><a href="/posts/4169548678/">Cheat Sheets - Photoshop</a></li>  <li class="file"><a href="/posts/3586350539/">Cheat sheets - Mac OS</a></li>  <li class="file"><a href="/posts/3905631645/">Cheat sheets - Xcode</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Project
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1755831586/">软件发布版本区别介绍</a></li>  <li class="file"><a href="/posts/467054247/">如何编写开源项目的README文档</a></li>  </ul> 
                        </li>
                         </ul> 
                        </li>
                        
                        <li class="directory-open" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                back-end
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory-open" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                Middle-ware
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Gogs
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/612684965/">私人Git服务器 -- gogs</a></li>  <li class="file"><a href="/posts/4076369309/">Gogs数据备份、恢复</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Jenkins
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2282359188/">jenkins密码重置</a></li>  <li class="file"><a href="/posts/388825549/">利用Jenkins持续集成iOS项目</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Logstash
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2615120416/">日志搜集处理框架Logstash-安装配置</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                MySQL
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/554387356/">MySQL 排序的艺术：你真的懂 Order By 吗？</a></li>  <li class="file"><a href="/posts/4284065059/">MySQL 调优/优化的 101 个建议</a></li>  <li class="file"><a href="/posts/2625460784/">MySQL延迟复制</a></li>  <li class="file"><a href="/posts/2654174479/">分库分表 vs NewSQL数据库</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Nginx
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1350143519/">高性能 Nginx HTTPS 调优 - 如何为 HTTPS 提速 30%</a></li>  <li class="file"><a href="/posts/3996389515/">Nginx配置跨域请求 Access-Control-Allow-Origin *</a></li>  <li class="file"><a href="/posts/1544228005/">高性能Web服务器 - Nginx配置详解</a></li>  <li class="file"><a href="/posts/524919010/">Nginx正向代理与Client设置代理上网</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                RabbitMQ
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2846671594/">RabbitMQ 集群高可用原理及实战部署介绍</a></li>  <li class="file"><a href="/posts/3135873234/">RabbitMQ入门</a></li>  </ul> 
                        </li>
                        
                        <li class="directory-open" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Redis
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/156114019/">Redis Stream应用案例</a></li>  <li class="file"><a href="/posts/2864310564/">深入分析Redis特点及应用场景</a></li>  <li class="file"><a href="/posts/2992538737/">redis.conf参数配置及解释</a></li>  <li class="file active"><a href="/posts/3909951181/">Redis Manual</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Sentry
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1303728868/">错误日志收集平台 - Sentry(Redis+MySQL)</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Shadowsocks
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3154796955/">Vultr快速搭建SS科学上网</a></li>  </ul> 
                        </li>
                         </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                NodeJS
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/2653381572/">NodeJS Package Manage Tool - NPM</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder-open"></i>
                                &nbsp;
                                Python
                            </a>
                             <ul class="unstyled" id="tree" style="display: block;"> 
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Build-in
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/857250976/">Python build-in functions - List</a></li>  <li class="file"><a href="/posts/2858153934/">Python build-in functions - collections</a></li>  <li class="file"><a href="/posts/3208674450/">Python build-in module - os</a></li>  <li class="file"><a href="/posts/2434599799/">Python build-in functions</a></li>  <li class="file"><a href="/posts/5/">Python多线程和锁</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Configuration
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/3568487154/">更改pip源至国内镜像 - 显著提升下载速度</a></li>  </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                Library
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/383305840/">Python Library - Flask SQLAlchemy</a></li>  <li class="file"><a href="/posts/4096440342/">Python Library - SQLAlchemy</a></li>  <li class="file"><a href="/posts/55626181/">发布你自己的轮子 - PyPI打包上传实践</a></li>  <li class="file"><a href="/posts/3634498847/">我用 Python 的 Seaborn 库，绘制了 17 个超好看图表!</a></li>  </ul> 
                        </li>
                         <li class="file"><a href="/posts/272954362/">sys.stdout.write实现Python控制台实时刷新打印</a></li>  </ul> 
                        </li>
                         </ul> 
                        </li>
                        
                        <li class="directory" id="">
                            <a href="#" data-role="directory">
                                <i class="fa fa-folder"></i>
                                &nbsp;
                                iOS Development
                            </a>
                             <ul class="unstyled" id="tree" >  <li class="file"><a href="/posts/1054462359/">Apple Store上iOS App上架流程</a></li>  <li class="file"><a href="/posts/684390890/">Swift 5.4 有什么新功能？</a></li>  <li class="file"><a href="/posts/3772598043/">Swift：解包的正确姿势</a></li>  <li class="file"><a href="/posts/1098789015/">Xcode开发中Build与version区别/build自增设置/build随时间变化？</a></li>  </ul> 
                        </li>
                         </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });
        });
    </script>


    
        
    <div class="widget-wrap">
        <h3 class="widget-title"><span>最新文章</span></h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/647907268/" class="thumbnail">
    
    
        <span style="background-image:url(https://jifu-pub-images.oss-ap-southeast-2.aliyuncs.com/20210416015030.jpg)" alt="苹果M1芯片Macbook安装win10" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/OPS/">OPS</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/OPS/MacOS/">MacOS</a></p>
                            <p class="item-title"><a href="/posts/647907268/" class="title">苹果M1芯片Macbook安装win10</a></p>
                            <p class="item-date"><time datetime="2021-04-15T13:28:19.000Z" itemprop="datePublished">2021-04-16</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/4263562837/" class="thumbnail">
    
    
        <span style="background-image:url(https://jifu-pub-images.oss-ap-southeast-2.aliyuncs.com/20210328134957.png)" alt="一个惊人快速的终端录像工具，也能录制 VSCode 和 Chrome 窗口" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/OPS/">OPS</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/OPS/MacOS/">MacOS</a></p>
                            <p class="item-title"><a href="/posts/4263562837/" class="title">一个惊人快速的终端录像工具，也能录制 VSCode 和 Chrome 窗口</a></p>
                            <p class="item-date"><time datetime="2021-03-28T00:02:47.000Z" itemprop="datePublished">2021-03-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/3634498847/" class="thumbnail">
    
    
        <span style="background-image:url(https://jifu-pub-images.oss-ap-southeast-2.aliyuncs.com/20210309111745.png)" alt="我用 Python 的 Seaborn 库，绘制了 17 个超好看图表!" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/back-end/">back-end</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/back-end/Python/">Python</a></p>
                            <p class="item-title"><a href="/posts/3634498847/" class="title">我用 Python 的 Seaborn 库，绘制了 17 个超好看图表!</a></p>
                            <p class="item-date"><time datetime="2021-03-08T22:18:11.000Z" itemprop="datePublished">2021-03-09</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/2097636152/" class="thumbnail">
    
    
        <span style="background-image:url(https://jifu-pub-images.oss-ap-southeast-2.aliyuncs.com/20210303212435.jpg)" alt="工作两三年了，整不明白架构图都画啥？" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Soft-engineering/">Soft engineering</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Soft-engineering/Architecture/">Architecture</a></p>
                            <p class="item-title"><a href="/posts/2097636152/" class="title">工作两三年了，整不明白架构图都画啥？</a></p>
                            <p class="item-date"><time datetime="2021-03-03T08:09:53.000Z" itemprop="datePublished">2021-03-03</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/posts/2846671594/" class="thumbnail">
    
    
        <span style="background-image:url(https://jifu-pub-images.oss-ap-southeast-2.aliyuncs.com/20210228142136.jpg)" alt="RabbitMQ 集群高可用原理及实战部署介绍" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/back-end/">back-end</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/back-end/Middle-ware/">Middle-ware</a></p>
                            <p class="item-title"><a href="/posts/2846671594/" class="title">RabbitMQ 集群高可用原理及实战部署介绍</a></p>
                            <p class="item-date"><time datetime="2021-02-28T01:06:06.000Z" itemprop="datePublished">2021-02-28</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-back-end/Middle-ware/Redis/redisManual" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/back-end/">back-end</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/back-end/Middle-ware/">Middle-ware</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/back-end/Middle-ware/Redis/">Redis</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Middleware/">Middleware</a>, <a class="tag-link" href="/tags/manual/">manual</a>, <a class="tag-link" href="/tags/redis/">redis</a>, <a class="tag-link" href="/tags/中间件/">中间件</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/posts/3909951181/">
            <time datetime="2018-05-08T03:27:04.000Z" itemprop="datePublished">2018-05-08</time>
        </a>
    </div>


                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            Redis Manual
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
                <div id="toc" class="toc-article">
                <strong class="toc-title">文章目录</strong>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis是什么"><span class="toc-number">1.</span> <span class="toc-text">Redis是什么</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-优势"><span class="toc-number">2.</span> <span class="toc-text">Redis 优势</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis如何安装"><span class="toc-number">3.</span> <span class="toc-text">Redis如何安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#如何启动Redis服务"><span class="toc-number">4.</span> <span class="toc-text">如何启动Redis服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#如何使用redis-cli客户端"><span class="toc-number">5.</span> <span class="toc-text">如何使用redis-cli客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#连接redis服务"><span class="toc-number">5.1.</span> <span class="toc-text">连接redis服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cli-服务端相关命令"><span class="toc-number">5.2.</span> <span class="toc-text">redis-cli -服务端相关命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cli-发布订阅相关命令"><span class="toc-number">5.3.</span> <span class="toc-text">redis-cli - 发布订阅相关命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cli-KEY操作的命令"><span class="toc-number">5.4.</span> <span class="toc-text">redis-cli - KEY操作的命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cli-String操作的命令"><span class="toc-number">5.5.</span> <span class="toc-text">redis-cli - String操作的命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cli-List操作的命令"><span class="toc-number">5.6.</span> <span class="toc-text">redis-cli - List操作的命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cli-Set操作的命令"><span class="toc-number">5.7.</span> <span class="toc-text">redis-cli - Set操作的命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cli-Hash操作的命令"><span class="toc-number">5.8.</span> <span class="toc-text">redis-cli - Hash操作的命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis支持数据结构有哪些"><span class="toc-number">6.</span> <span class="toc-text">redis支持数据结构有哪些</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据结构-String"><span class="toc-number">6.1.</span> <span class="toc-text">数据结构 - String</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据结构-–-lists"><span class="toc-number">6.2.</span> <span class="toc-text">数据结构 – lists</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据结构-–-set"><span class="toc-number">6.3.</span> <span class="toc-text">数据结构 – set</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据结构-–-sorted-sets"><span class="toc-number">6.4.</span> <span class="toc-text">数据结构 – sorted sets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据结构-–-hash"><span class="toc-number">6.5.</span> <span class="toc-text">数据结构 – hash</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis持久化-–-介绍"><span class="toc-number">7.</span> <span class="toc-text">redis持久化 – 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#redis持久化-–-RDB"><span class="toc-number">7.1.</span> <span class="toc-text">redis持久化 – RDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis持久化-–-AOF"><span class="toc-number">7.2.</span> <span class="toc-text">redis持久化 – AOF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#redis持久化-–-AOF重写"><span class="toc-number">7.2.1.</span> <span class="toc-text">redis持久化 – AOF重写</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis持久化-–-如何选择RDB和AOF"><span class="toc-number">7.3.</span> <span class="toc-text">redis持久化 – 如何选择RDB和AOF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis主从-–-介绍"><span class="toc-number">8.</span> <span class="toc-text">redis主从 – 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#redis主从-–-同步原理"><span class="toc-number">8.1.</span> <span class="toc-text">redis主从 – 同步原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis事务"><span class="toc-number">9.</span> <span class="toc-text">redis事务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis配置-–-简介"><span class="toc-number">10.</span> <span class="toc-text">redis配置 – 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis配置-–-通用"><span class="toc-number">11.</span> <span class="toc-text">redis配置 – 通用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#redis配置-快照"><span class="toc-number">11.1.</span> <span class="toc-text">redis配置 - 快照</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis配置-–-复制"><span class="toc-number">11.2.</span> <span class="toc-text">redis配置 – 复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis配置-安全"><span class="toc-number">11.3.</span> <span class="toc-text">redis配置 - 安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis配置-限制"><span class="toc-number">11.4.</span> <span class="toc-text">redis配置 - 限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis配置-追加模式"><span class="toc-number">11.5.</span> <span class="toc-text">redis配置 - 追加模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis配置-–-LUA脚本"><span class="toc-number">11.6.</span> <span class="toc-text">redis配置 – LUA脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis配置-–-慢日志"><span class="toc-number">11.7.</span> <span class="toc-text">redis配置 – 慢日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis配置-–-事件通知"><span class="toc-number">11.8.</span> <span class="toc-text">redis配置 – 事件通知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis配置-–-高级配置"><span class="toc-number">11.9.</span> <span class="toc-text">redis配置 – 高级配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis哨兵机制-Sentinel"><span class="toc-number">12.</span> <span class="toc-text">redis哨兵机制 - Sentinel</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Sentinel的作用"><span class="toc-number">12.1.</span> <span class="toc-text">Sentinel的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sentinel的工作方式"><span class="toc-number">12.2.</span> <span class="toc-text">Sentinel的工作方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sentinel简要搭建方法"><span class="toc-number">12.3.</span> <span class="toc-text">Sentinel简要搭建方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境概要"><span class="toc-number">12.3.1.</span> <span class="toc-text">环境概要</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置主从服务"><span class="toc-number">12.3.2.</span> <span class="toc-text">设置主从服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置sentinel服务"><span class="toc-number">12.3.3.</span> <span class="toc-text">配置sentinel服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#命令测试sentinel服务"><span class="toc-number">12.3.4.</span> <span class="toc-text">命令测试sentinel服务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis集群-redis-cluster"><span class="toc-number">13.</span> <span class="toc-text">redis集群 - redis cluster</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cluster是什么"><span class="toc-number">13.1.</span> <span class="toc-text">redis cluster是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cluster结构特点"><span class="toc-number">13.2.</span> <span class="toc-text">redis cluster结构特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-Cluster主从模式"><span class="toc-number">13.3.</span> <span class="toc-text">Redis Cluster主从模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-cluster简要搭建方法"><span class="toc-number">13.4.</span> <span class="toc-text">redis cluster简要搭建方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">14.</span> <span class="toc-text">参考资料</span></a></li></ol>
                </div>
            
        
        
            <p><img src="https://www.jifu.io/images/2/Untitled-1.jpg" alt=""></p>
<h1 id="Redis是什么"><a href="#Redis是什么" class="headerlink" title="Redis是什么"></a>Redis是什么</h1><p><code>redis</code>（REmote DIctionary Server）是一个开源的、使用C语言编写的、支持网络交互的、基于内存也可持久化的高性能Key-Value数据库。</p>
<p><code>redis</code>的官网地址，非常好记，是<code>redis.io</code>。（特意查了一下，域名后缀io属于国家域名，是british Indian Ocean territory，即英属印度洋领地）</p>
<p>目前，<code>Vmware</code>在资助着<code>redis</code>项目的开发和维护。</p>
<a id="more"></a>
<h1 id="Redis-优势"><a href="#Redis-优势" class="headerlink" title="Redis 优势"></a>Redis 优势</h1><p><code>性能极高</code> – Redis非常快，每秒可执行大约110000次的设置(SET)操作，每秒大约可执行81000次的读取/获取(GET)操作。</p>
<p><code>支持丰富的数据类型</code> - Redis支持开发人员常用的大多数数据类型，例如列表，集合，排序集和散列等等。这使得Redis很容易被用来解决各种问题，因为我们知道哪些问题可以更好使用地哪些数据类型来处理解决。</p>
<p><code>操作具有原子性</code> - 所有Redis操作都是原子操作，这确保如果两个客户端并发访问，Redis服务器能接收更新的值。</p>
<p><code>多实用工具</code> - Redis是一个多实用工具，可用于多种用例，如：缓存，消息队列(Redis本地支持发布/订阅)，应用程序中的任何短期数据，例如，web应用程序中的会话，网页命中计数等。</p>
<p><code>支持数据的持久化</code> - 可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</p>
<p>注意：<code>一个键最大能存储512MB</code>。</p>
<h1 id="Redis如何安装"><a href="#Redis如何安装" class="headerlink" title="Redis如何安装"></a>Redis如何安装</h1><p>从<code>redis.io</code>下载最新版<code>redis-X.Y.Z.tar.gz</code>后解压，然后进入<code>redis-X.Y.Z</code>文件夹后直接make即可，安装非常简单。</p>
<p>make成功后会在src文件夹下产生一些二进制可执行文件，包括<code>redis-server</code>、<code>redis-cli</code>等等：</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">find</span> <span class="token keyword">.</span> -type f -executable
./redis-benchmark //用于进行redis性能测试的工具
./redis-check-dump //用于修复出问题的dump.rdb文件
./redis-cli //redis的客户端
./redis-server //redis的服务端
./redis-check-aof //用于修复出问题的AOF文件
./redis-sentinel //用于集群管理
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="如何启动Redis服务"><a href="#如何启动Redis服务" class="headerlink" title="如何启动Redis服务"></a>如何启动Redis服务</h1><p>启动redis非常简单，直接<code>./redis-server</code>就可以启动服务端了，还可以用下面的方法指定要加载的配置文件：</p>
<p><code>./redis-server ../redis.conf</code></p>
<p>默认情况下，<code>redis-server</code>会以非<code>daemon</code>的方式来运行，且默认服务端口为<code>6379</code>。</p>
<h1 id="如何使用redis-cli客户端"><a href="#如何使用redis-cli客户端" class="headerlink" title="如何使用redis-cli客户端"></a>如何使用redis-cli客户端</h1><h2 id="连接redis服务"><a href="#连接redis服务" class="headerlink" title="连接redis服务"></a>连接redis服务</h2><pre class="line-numbers language-bash"><code class="language-bash">//这样来启动redis客户端了
$ ./redis-cli
//用set指令来设置key、value
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> name <span class="token string">"roc"</span>
OK
//来获取name的值
127.0.0.1:6379<span class="token operator">></span> get name
<span class="token string">"roc"</span>
//通过客户端来关闭redis服务端
127.0.0.1:6379<span class="token operator">></span> <span class="token function">shutdown</span>
127.0.0.1:6379<span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="redis-cli-服务端相关命令"><a href="#redis-cli-服务端相关命令" class="headerlink" title="redis-cli -服务端相关命令"></a>redis-cli -服务端相关命令</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>time</code></td>
<td>返回当前服务器时间</td>
</tr>
<tr>
<td><code>client list</code></td>
<td><a href="http://redisdoc.com/server/client_list.html" target="_blank" rel="noopener">返回所有连接到服务器的客户端信息和统计数据</a></td>
</tr>
<tr>
<td><code>client kill ip:port</code></td>
<td>关闭地址为 ip:port 的客户端</td>
</tr>
<tr>
<td><code>save</code></td>
<td>将数据同步保存到磁盘</td>
</tr>
<tr>
<td><code>bgsave</code></td>
<td>将数据异步保存到磁盘</td>
</tr>
<tr>
<td><code>lastsave</code></td>
<td>返回上次成功将数据保存至磁盘的Unix时戳</td>
</tr>
<tr>
<td><code>shundown</code></td>
<td>将数据同步保存到磁盘，然后关闭服务</td>
</tr>
<tr>
<td><code>info</code></td>
<td>提供服务器的信息和统计</td>
</tr>
<tr>
<td><code>config resetstat</code></td>
<td>重置info命令中的某些统计数据</td>
</tr>
<tr>
<td><code>config get</code></td>
<td>获取配置文件信息</td>
</tr>
<tr>
<td><code>config set</code></td>
<td>动态地调整 Redis 服务器的配置而无须重启，<br>可以修改的配置参数可以使用命令 CONFIG GET * 来列</td>
</tr>
<tr>
<td><code>config rewrite</code></td>
<td>Redis 启动时的 redis.conf 改写</td>
</tr>
<tr>
<td><code>monitor</code></td>
<td>实时转储收到的请求</td>
</tr>
<tr>
<td><code>slaveof</code></td>
<td>改变复制策略设置</td>
</tr>
</tbody>
</table>
<h2 id="redis-cli-发布订阅相关命令"><a href="#redis-cli-发布订阅相关命令" class="headerlink" title="redis-cli - 发布订阅相关命令"></a>redis-cli - 发布订阅相关命令</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>psubscribe</code></td>
<td>订阅一个或多个符合给定模式的频道 例如psubscribe news.<em> tweet.</em></td>
</tr>
<tr>
<td><code>publish</code></td>
<td>将信息 message 发送到指定的频道 channel 例如publish msg “good morning”</td>
</tr>
<tr>
<td><code>pubsub channels</code></td>
<td>列出当前的活跃频道 例如PUBSUB CHANNELS news.i*</td>
</tr>
<tr>
<td><code>pubsub numsub</code></td>
<td>返回给定频道的订阅者数量 例如PUBSUB NUMSUB news.it news.internet news.sport news.music</td>
</tr>
<tr>
<td><code>pubsub numpat</code></td>
<td>返回客户端订阅的所有模式的数量总和</td>
</tr>
<tr>
<td><code>punsubscribe</code></td>
<td>指示客户端退订所有给定模式。</td>
</tr>
<tr>
<td><code>subscribe</code></td>
<td>订阅给定的一个或多个频道的信息。例如 subscribe msg chat_room</td>
</tr>
<tr>
<td><code>unsubscribe</code></td>
<td>指示客户端退订给定的频道。</td>
</tr>
</tbody>
</table>
<h2 id="redis-cli-KEY操作的命令"><a href="#redis-cli-KEY操作的命令" class="headerlink" title="redis-cli - KEY操作的命令"></a>redis-cli - KEY操作的命令</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exists(key)</code></td>
<td>确认一个key是否存在</td>
</tr>
<tr>
<td><code>el(key)</code></td>
<td>删除一个key</td>
</tr>
<tr>
<td><code>type(key)</code></td>
<td>返回值的类型</td>
</tr>
<tr>
<td><code>keys(pattern)</code></td>
<td>返回满足给定pattern的所有key</td>
</tr>
<tr>
<td><code>randomkey</code></td>
<td>随机返回key空间的一个</td>
</tr>
<tr>
<td><code>keyrename(oldname, newname)</code></td>
<td>重命名key</td>
</tr>
<tr>
<td><code>dbsize</code></td>
<td>返回当前数据库中key的数目</td>
</tr>
<tr>
<td><code>expire</code></td>
<td>设定一个key的活动时间（s）</td>
</tr>
<tr>
<td><code>ttl</code></td>
<td>获得一个key的活动时间</td>
</tr>
<tr>
<td><code>move(key, dbindex)</code></td>
<td>移动当前数据库中的key到dbindex数据库</td>
</tr>
<tr>
<td><code>flushdb</code></td>
<td>删除当前选择数据库中的所有key</td>
</tr>
<tr>
<td><code>flushall</code></td>
<td>删除所有数据库中的所有key</td>
</tr>
</tbody>
</table>
<h2 id="redis-cli-String操作的命令"><a href="#redis-cli-String操作的命令" class="headerlink" title="redis-cli - String操作的命令"></a>redis-cli - String操作的命令</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>set(key, value)</code></td>
<td>给数据库中名称为key的string赋予值value</td>
</tr>
<tr>
<td><code>get(key)</code></td>
<td>返回数据库中名称为key的string的value</td>
</tr>
<tr>
<td><code>getset(key, value)</code></td>
<td>给名称为key的string赋予上一次的value</td>
</tr>
<tr>
<td><code>mget(key1, key2,…, key N)</code></td>
<td>返回库中多个string的value</td>
</tr>
<tr>
<td><code>setnx(key, value)</code></td>
<td>添加string，名称为key，值为value</td>
</tr>
<tr>
<td><code>setex(key, time, value)</code></td>
<td>向库中添加string，设定过期时间time</td>
</tr>
<tr>
<td><code>mset(key N, value N)</code></td>
<td>批量设置多个string的值</td>
</tr>
<tr>
<td><code>msetnx(key N, value N)</code></td>
<td>如果所有名称为key i的string都不存在</td>
</tr>
<tr>
<td><code>incr(key)</code></td>
<td>名称为key的string增1操作</td>
</tr>
<tr>
<td><code>incrby(key, integer)</code></td>
<td>名称为key的string增加integer</td>
</tr>
<tr>
<td><code>decr(key)</code></td>
<td>名称为key的string减1操作</td>
</tr>
<tr>
<td><code>decrby(key, integer)</code></td>
<td>名称为key的string减少integer</td>
</tr>
<tr>
<td><code>append(key, value)</code></td>
<td>名称为key的string的值附加value</td>
</tr>
<tr>
<td><code>substr(key, start, end)</code></td>
<td>返回名称为key的string的value的子串</td>
</tr>
</tbody>
</table>
<h2 id="redis-cli-List操作的命令"><a href="#redis-cli-List操作的命令" class="headerlink" title="redis-cli - List操作的命令"></a>redis-cli - List操作的命令</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rpush(key, value)</code></td>
<td>在名称为key的list尾添加一个值为value的元素</td>
</tr>
<tr>
<td><code>lpush(key, value)</code></td>
<td>在名称为key的list头添加一个值为value的 元素</td>
</tr>
<tr>
<td><code>llen(key)</code></td>
<td>返回名称为key的list的长度</td>
</tr>
<tr>
<td><code>lrange(key, start, end)</code></td>
<td>返回名称为key的list中start至end之间的元素</td>
</tr>
<tr>
<td><code>ltrim(key, start, end)</code></td>
<td>截取名称为key的list</td>
</tr>
<tr>
<td><code>lindex(key, index)</code></td>
<td>返回名称为key的list中index位置的元素</td>
</tr>
<tr>
<td><code>lset(key, index, value)</code></td>
<td>给名称为key的list中index位置的元素赋值</td>
</tr>
<tr>
<td><code>lrem(key, count, value)</code></td>
<td>删除count个key的list中值为value的元素</td>
</tr>
<tr>
<td><code>lpop(key)</code></td>
<td>返回并删除名称为key的list中的首元素</td>
</tr>
<tr>
<td><code>rpop(key)</code></td>
<td>返回并删除名称为key的list中的尾元素</td>
</tr>
<tr>
<td><code>blpop(key1, key2,… key N, timeout)</code></td>
<td>lpop命令的block版本。</td>
</tr>
<tr>
<td><code>brpop(key1, key2,… key N, timeout)</code></td>
<td>rpop的block版本。</td>
</tr>
<tr>
<td><code>rpoplpush(srckey, dstkey)</code></td>
<td>返回并删除名称为srckey的list的尾元素，并将该元素添加到名称为dstkey的list的头部</td>
</tr>
</tbody>
</table>
<h2 id="redis-cli-Set操作的命令"><a href="#redis-cli-Set操作的命令" class="headerlink" title="redis-cli - Set操作的命令"></a>redis-cli - Set操作的命令</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sadd(key, member)</code></td>
<td>向名称为key的set中添加元素member</td>
</tr>
<tr>
<td><code>srem(key, member)</code></td>
<td>删除名称为key的set中的元素member</td>
</tr>
<tr>
<td><code>spop(key)</code></td>
<td>随机返回并删除名称为key的set中一个元素</td>
</tr>
<tr>
<td><code>smove(srckey, dstkey, member)</code></td>
<td>移到集合元素</td>
</tr>
<tr>
<td><code>scard(key)</code></td>
<td>返回名称为key的set的基数</td>
</tr>
<tr>
<td><code>sismember(key, member)</code></td>
<td>member是否是名称为key的set的元素</td>
</tr>
<tr>
<td><code>sinter(key1, key2,…key N)</code></td>
<td>求交集</td>
</tr>
<tr>
<td><code>sinterstore(dstkey, (keys))</code></td>
<td>求交集并将交集保存到dstkey的集合</td>
</tr>
<tr>
<td><code>sunion(key1, (keys))</code></td>
<td>求并集</td>
</tr>
<tr>
<td><code>sunionstore(dstkey, (keys))</code></td>
<td>求并集并将并集保存到dstkey的集合</td>
</tr>
<tr>
<td><code>sdiff(key1, (keys))</code></td>
<td>求差集</td>
</tr>
<tr>
<td><code>sdiffstore(dstkey, (keys))</code></td>
<td>求差集并将差集保存到dstkey的集合</td>
</tr>
<tr>
<td><code>smembers(key)</code></td>
<td>返回名称为key的set的所有元素</td>
</tr>
<tr>
<td><code>srandmember(key)</code></td>
<td>随机返回名称为key的set的一个元素</td>
</tr>
</tbody>
</table>
<h2 id="redis-cli-Hash操作的命令"><a href="#redis-cli-Hash操作的命令" class="headerlink" title="redis-cli - Hash操作的命令"></a>redis-cli - Hash操作的命令</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hset(key, field, value)</code></td>
<td>向名称为key的hash中添加元素field</td>
</tr>
<tr>
<td><code>hget(key, field)</code></td>
<td>返回名称为key的hash中field对应的value</td>
</tr>
<tr>
<td><code>hmget(key, (fields))</code></td>
<td>返回名称为key的hash中field i对应的value</td>
</tr>
<tr>
<td><code>hmset(key, (fields))</code></td>
<td>向名称为key的hash中添加元素field</td>
</tr>
<tr>
<td><code>hincrby(key, field, integer)</code></td>
<td>将名称为key的hash中field的value增加integer</td>
</tr>
<tr>
<td><code>hexists(key, field)</code></td>
<td>名称为key的hash中是否存在键为field的域</td>
</tr>
<tr>
<td><code>hdel(key, field)</code></td>
<td>删除名称为key的hash中键为field的域</td>
</tr>
<tr>
<td><code>hlen(key)</code></td>
<td>返回名称为key的hash中元素个数</td>
</tr>
<tr>
<td><code>hkeys(key)</code></td>
<td>返回名称为key的hash中所有键</td>
</tr>
<tr>
<td><code>hvals(key)</code></td>
<td>返回名称为key的hash中所有键对应的value</td>
</tr>
<tr>
<td><code>hgetall(key)</code></td>
<td>返回名称为key的hash中所有的键（field）及其对应的value</td>
</tr>
</tbody>
</table>
<h1 id="redis支持数据结构有哪些"><a href="#redis支持数据结构有哪些" class="headerlink" title="redis支持数据结构有哪些"></a>redis支持数据结构有哪些</h1><p>redis是一种高级的<code>key:value</code>存储系统，其中value支持五种数据类型：</p>
<p>1.字符串（<code>strings</code>）<br>2.字符串列表（<code>lists</code>）<br>3.字符串集合（<code>sets</code>）<br>4.有序字符串集合（<code>sorted sets</code>）<br>5.哈希（<code>hashes</code>）</p>
<p>而关于key，有几个点要提醒大家：</p>
<p>1.key不要太长，尽量不要超过<code>1024</code>字节，这不仅消耗内存，而且会降低查找的效率；<br>2.key也不要太短，太短的话，key的可读性会降低；<br>3.在一个项目中，key最好使用统一的命名模式，例如<code>user:10000:passwd</code>。</p>
<h2 id="数据结构-String"><a href="#数据结构-String" class="headerlink" title="数据结构 - String"></a>数据结构 - String</h2><p>有人说，如果只使用redis中的字符串类型，且不使用redis的持久化功能，那么，redis就和memcache非常非常的像了。这说明strings类型是一个很基础的数据类型，也是任何存储系统都必备的数据类型。</p>
<p>我们来看一个最简单的例子：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">set</span> mystr <span class="token string">"hello world!"</span> //设置字符串类型
get mystr //读取字符串类型
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>字符串类型的用法就是这么简单，因为是二进制安全的，所以你完全可以把一个图片文件的内容作为字符串来存储。</p>
<p>另外，我们还可以通过字符串类型进行数值操作：</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> mynum <span class="token string">"2"</span>
OK
127.0.0.1:6379<span class="token operator">></span> get mynum
<span class="token string">"2"</span>
127.0.0.1:6379<span class="token operator">></span> incr mynum
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> get mynum
<span class="token string">"3"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>看，在遇到数值操作时，<code>redis</code>会将字符串类型转换成数值。</p>
<p>由于INCR等指令本身就具有原子操作的特性，所以我们完全可以利用redis的<code>INCR</code>、<code>INCRBY</code>、<code>DECR</code>、<code>DECRBY</code>等指令来实现原子计数的效果，假如，在某种场景下有3个客户端同时读取了<code>mynum</code>的值（值为2），然后对其同时进行了加1的操作，那么，最后<code>mynum</code>的值一定是<code>5</code>。不少网站都利用redis的这个特性来实现业务上的统计计数需求。</p>
<h2 id="数据结构-–-lists"><a href="#数据结构-–-lists" class="headerlink" title="数据结构 – lists"></a>数据结构 – lists</h2><p>redis的另一个重要的数据结构叫做<code>lists</code>，翻译成中文叫做“列表”。</p>
<p>首先要明确一点，redis中的<code>lists</code>在底层实现上并不是数组，而是链表，也就是说对于一个具有上百万个元素的lists来说，在头部和尾部插入一个新元素，其时间复杂度是常数级别的，比如用<code>LPUSH</code>在10个元素的lists头部插入新元素，和在上千万元素的lists头部插入新元素的速度应该是相同的。</p>
<p>虽然lists有这样的优势，但同样有其弊端，那就是，链表型lists的元素定位会比较慢，而数组型lists的元素定位就会快得多。</p>
<p>lists的常用操作包括<code>LPUSH</code>、<code>RPUSH</code>、<code>LRANGE</code>等。我们可以用<code>LPUSH</code>在lists的左侧插入一个新元素，用<code>RPUSH</code>在lists的右侧插入一个新元素，用<code>LRANGE</code>命令从lists中指定一个范围来提取元素。</p>
<pre class="line-numbers language-bash"><code class="language-bash">//新建一个list叫做mylist，并在列表头部插入元素<span class="token string">"1"</span>
127.0.0.1:6379<span class="token operator">></span> lpush mylist <span class="token string">"1"</span>
//返回当前mylist中的元素个数
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
//在mylist右侧插入元素<span class="token string">"2"</span>
127.0.0.1:6379<span class="token operator">></span> rpush mylist <span class="token string">"2"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
//在mylist左侧插入元素<span class="token string">"0"</span>
127.0.0.1:6379<span class="token operator">></span> lpush mylist <span class="token string">"0"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
//列出mylist中从编号0到编号1的元素
127.0.0.1:6379<span class="token operator">></span> lrange mylist 0 1
1<span class="token punctuation">)</span> <span class="token string">"0"</span>
2<span class="token punctuation">)</span> <span class="token string">"1"</span>
//列出mylist中从编号0到倒数第一个元素
127.0.0.1:6379<span class="token operator">></span> lrange mylist 0 -1
1<span class="token punctuation">)</span> <span class="token string">"0"</span>
2<span class="token punctuation">)</span> <span class="token string">"1"</span>
3<span class="token punctuation">)</span> <span class="token string">"2"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>lists</code>的应用相当广泛，随便举几个例子：</p>
<p>1.我们可以利用<code>lists</code>来实现一个消息队列，而且可以确保先后顺序，不必像MySQL那样还需要通过<code>ORDER BY</code>来进行排序。<br>2.利用<code>LRANGE</code>还可以很方便的实现分页的功能。<br>3.在博客系统中，每片博文的评论也可以存入一个单独的<code>list</code>中。</p>
<h2 id="数据结构-–-set"><a href="#数据结构-–-set" class="headerlink" title="数据结构 – set"></a>数据结构 – set</h2><p>redis的集合，是一种无序的集合，集合中的元素没有先后顺序。</p>
<p>集合相关的操作也很丰富，如添加新元素、删除已有元素、取交集、取并集、取差集等。</p>
<pre class="line-numbers language-bash"><code class="language-bash">//向集合myset中加入一个新元素<span class="token string">"one"</span>
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token string">"one"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token string">"two"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
//列出集合myset中的所有元素
127.0.0.1:6379<span class="token operator">></span> smembers myset
1<span class="token punctuation">)</span> <span class="token string">"one"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
//判断元素1是否在集合myset中，返回1表示存在
127.0.0.1:6379<span class="token operator">></span> sismember myset <span class="token string">"one"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
//判断元素3是否在集合myset中，返回0表示不存在
127.0.0.1:6379<span class="token operator">></span> sismember myset <span class="token string">"three"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
//新建一个新的集合yourset
127.0.0.1:6379<span class="token operator">></span> sadd yourset <span class="token string">"1"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd yourset <span class="token string">"2"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> smembers yourset
1<span class="token punctuation">)</span> <span class="token string">"1"</span>
2<span class="token punctuation">)</span> <span class="token string">"2"</span>
//对两个集合求并集
127.0.0.1:6379<span class="token operator">></span> sunion myset yourset
1<span class="token punctuation">)</span> <span class="token string">"1"</span>
2<span class="token punctuation">)</span> <span class="token string">"one"</span>
3<span class="token punctuation">)</span> <span class="token string">"2"</span>
4<span class="token punctuation">)</span> <span class="token string">"two"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="数据结构-–-sorted-sets"><a href="#数据结构-–-sorted-sets" class="headerlink" title="数据结构 – sorted sets"></a>数据结构 – sorted sets</h2><p>redis不但提供了无需集合（<code>sets</code>），还很体贴的提供了有序集合（<code>sorted sets</code>）。有序集合中的每个元素都关联一个序号（score），这便是排序的依据。</p>
<p>很多时候，我们都将redis中的有序集合叫做<code>zsets</code>，这是因为在redis中，有序集合相关的操作指令都是以z开头的，比如<code>zrange</code>、<code>zadd</code>、<code>zrevrange</code>、<code>zrangebyscore</code>等等</p>
<pre class="line-numbers language-bash"><code class="language-bash">//新增一个有序集合myzset，并加入一个元素baidu.com，给它赋予的序号是1：
127.0.0.1:6379<span class="token operator">></span> zadd myzset 1 baidu.com
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
//向myzset中新增一个元素360.com，赋予它的序号是3
127.0.0.1:6379<span class="token operator">></span> zadd myzset 3 360.com
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
//向myzset中新增一个元素google.com，赋予它的序号是2
127.0.0.1:6379<span class="token operator">></span> zadd myzset 2 google.com
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
//列出myzset的所有元素，同时列出其序号，可以看出myzset已经是有序的了。
127.0.0.1:6379<span class="token operator">></span> zrange myzset 0 -1 with scores
1<span class="token punctuation">)</span> <span class="token string">"baidu.com"</span>
2<span class="token punctuation">)</span> <span class="token string">"1"</span>
3<span class="token punctuation">)</span> <span class="token string">"google.com"</span>
4<span class="token punctuation">)</span> <span class="token string">"2"</span>
5<span class="token punctuation">)</span> <span class="token string">"360.com"</span>
6<span class="token punctuation">)</span> <span class="token string">"3"</span>
//只列出myzset的元素
127.0.0.1:6379<span class="token operator">></span> zrange myzset 0 -1
1<span class="token punctuation">)</span> <span class="token string">"baidu.com"</span>
2<span class="token punctuation">)</span> <span class="token string">"google.com"</span>
3<span class="token punctuation">)</span> <span class="token string">"360.com"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="数据结构-–-hash"><a href="#数据结构-–-hash" class="headerlink" title="数据结构 – hash"></a>数据结构 – hash</h2><p>最后要给大家介绍的是<code>hashes</code>，即哈希。哈希是从redis-2.0.0版本之后才有的数据结构。</p>
<p><code>hashes</code>存的是字符串和字符串值之间的映射，比如一个用户要存储其全名、姓氏、年龄等等，就很适合使用哈希。</p>
<pre class="line-numbers language-bash"><code class="language-bash">//建立哈希，并赋值
127.0.0.1:6379<span class="token operator">></span> HMSET user:001 username antirez password P1pp0 age 34
OK
//列出哈希的内容
127.0.0.1:6379<span class="token operator">></span> HGETALL user:001
1<span class="token punctuation">)</span> <span class="token string">"username"</span>
2<span class="token punctuation">)</span> <span class="token string">"antirez"</span>
3<span class="token punctuation">)</span> <span class="token string">"password"</span>
4<span class="token punctuation">)</span> <span class="token string">"P1pp0"</span>
5<span class="token punctuation">)</span> <span class="token string">"age"</span>
6<span class="token punctuation">)</span> <span class="token string">"34"</span>
//更改哈希中的某一个值
127.0.0.1:6379<span class="token operator">></span> HSET user:001 password 12345
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
//再次列出哈希的内容
127.0.0.1:6379<span class="token operator">></span> HGETALL user:001
1<span class="token punctuation">)</span> <span class="token string">"username"</span>
2<span class="token punctuation">)</span> <span class="token string">"antirez"</span>
3<span class="token punctuation">)</span> <span class="token string">"password"</span>
4<span class="token punctuation">)</span> <span class="token string">"12345"</span>
5<span class="token punctuation">)</span> <span class="token string">"age"</span>
6<span class="token punctuation">)</span> <span class="token string">"34"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="redis持久化-–-介绍"><a href="#redis持久化-–-介绍" class="headerlink" title="redis持久化 – 介绍"></a>redis持久化 – 介绍</h1><p>redis提供了两种持久化的方式，分别是<code>RDB</code>（Redis DataBase）和<code>AOF</code>（Append Only File）。</p>
<p><code>RDB</code> (RDB<code>默认开启</code>)，简而言之，就是在不同的时间点，将redis存储的数据生成快照并存储到磁盘等介质上；</p>
<p><code>AOF</code>，则是换了一个角度来实现持久化，那就是将redis执行过的所有写指令记录下来，在下次redis重新启动时，只要把这些写指令从前到后再重复执行一遍，就可以实现数据恢复了。</p>
<p>其实<code>RDB</code>和<code>AOF</code>两种方式也可以同时使用，在这种情况下，如果redis重启的话，则会优先采用<code>AOF</code>方式来进行数据恢复，这是因为AOF方式的数据恢复完整度更高。</p>
<p>如果你没有数据持久化的需求，也完全可以关闭<code>RDB</code>和<code>AOF</code>方式，这样的话，redis将变成一个纯内存数据库，就像<code>memcache</code>一样。</p>
<h2 id="redis持久化-–-RDB"><a href="#redis持久化-–-RDB" class="headerlink" title="redis持久化 – RDB"></a>redis持久化 – RDB</h2><p><code>RDB</code>(Snapshot)方式，是将redis某一时刻的数据持久化到磁盘中，是一种快照式的持久化方法。</p>
<p>优点：<code>使用单独子进程来进行持久化，主进程不会进行任何IO操作，保证了redis的高性能</code></p>
<p>缺点：<code>RDB是间隔一段时间进行持久化，如果持久化之间redis发生故障，会发生数据丢失。所以这种方式更适合数据要求不严谨的时候</code></p>
<p><img src="https://www.jifu.io/images/2/18002227_ywV1.jpg.png" alt=""></p>
<p>redis在进行数据持久化的过程中，会先将数据写入到一个临时文件中，待持久化过程都结束了，才会用这个临时文件替换上次持久化好的文件。正是这种特性，让我们可以随时来进行备份，因为快照文件总是完整可用的。</p>
<p>对于<code>RDB</code>方式，redis会单独创建（<code>fork</code>）一个子进程来进行持久化，而主进程是不会进行任何IO操作的，这样就确保了redis极高的性能。</p>
<p>如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。</p>
<p>虽然<code>RDB</code>有不少优点，但它的缺点也是不容忽视的。如果你对数据的完整性非常敏感，那么<code>RDB</code>方式就不太适合你，因为即使你每5分钟都持久化一次，当redis故障时，仍然会有近5分钟的数据丢失。所以，redis还提供了另一种持久化方式，那就是<code>AOF</code>。</p>
<h2 id="redis持久化-–-AOF"><a href="#redis持久化-–-AOF" class="headerlink" title="redis持久化 – AOF"></a>redis持久化 – AOF</h2><p><code>AOF</code>，英文是Append Only File，即只允许追加不允许改写的文件。</p>
<p>优点：<code>可以保持更高的数据完整性，如果设置追加file的时间是1s，如果redis发生故障，最多会丢失1s的数据；且如果日志写入不完整支持redis-check-aof来进行日志修复；AOF文件没被rewrite之前（文件过大时会对命令进行合并重写），可以删除其中的某些命令（比如误操作的flushall）。</code></p>
<p>缺点：<code>AOF文件比RDB文件大，且恢复速度慢。</code></p>
<p><img src="https://www.jifu.io/images/2/18002228_wLze.jpg.png" alt=""></p>
<p>如前面介绍的，<code>AOF</code>方式是将执行过的写指令记录下来，在数据恢复时按照从前到后的顺序再将指令都执行一遍，就这么简单。</p>
<p>我们通过配置<code>redis.conf</code>中的<code>appendonly yes</code>就可以打开<code>AOF</code>功能。如果有写操作（如SET等），redis就会被追加到AOF文件的末尾。</p>
<p>默认的<code>AOF</code>持久化策略是每秒钟fsync一次（fsync是指把缓存中的写指令记录到磁盘中），因为在这种情况下，redis仍然可以保持很好的处理性能，即使redis故障，也只会丢失最近1秒钟的数据。</p>
<p>如果在追加日志时，恰好遇到磁盘空间满、inode满或断电等情况导致日志写入不完整，也没有关系，redis提供了<code>redis-check-aof</code>工具，可以用来进行日志修复。</p>
<p>因为采用了追加方式，如果不做任何处理的话，AOF文件会变得越来越大，为此，redis提供了<code>AOF文件重写（rewrite）机制</code>，即当AOF文件的大小超过所设定的阈值时，redis就会启动AOF文件的内容压缩，只保留可以恢复数据的最小指令集。举个例子或许更形象，假如我们调用了100次INCR指令，在AOF文件中就要存储100条指令，但这明显是很低效的，完全可以把这100条指令合并成一条SET指令，这就是重写机制的原理。</p>
<p>在进行AOF重写时，仍然是采用先写临时文件，全部完成后再替换的流程，所以断电、磁盘满等问题都不会影响AOF文件的可用性，这点大家可以放心。</p>
<p>AOF方式的另一个好处，我们通过一个“场景再现”来说明。某同学在操作redis时，不小心执行了FLUSHALL，导致redis内存中的数据全部被清空了，这是很悲剧的事情。不过这也不是世界末日，只要redis配置了AOF持久化方式，且AOF文件还没有被重写（rewrite），我们就可以用最快的速度暂停redis并编辑AOF文件，将最后一行的FLUSHALL命令删除，然后重启redis，就可以恢复redis的所有数据到FLUSHALL之前的状态了。是不是很神奇，这就是AOF持久化方式的好处之一。但是如果AOF文件已经被重写了，那就无法通过这种方法来恢复数据了。</p>
<p>虽然优点多多，但AOF方式也同样存在缺陷，比如在同样数据规模的情况下，AOF文件要比RDB文件的体积大。而且，AOF方式的恢复速度也要慢于RDB方式。</p>
<p>如果你直接执行BGREWRITEAOF命令，那么redis会生成一个全新的AOF文件，其中便包括了可以恢复现有数据的最少的命令集。</p>
<p>如果运气比较差，AOF文件出现了被写坏的情况，也不必过分担忧，redis并不会贸然加载这个有问题的AOF文件，而是报错退出。这时可以通过以下步骤来修复出错的文件：</p>
<p>1.备份被写坏的AOF文件<br>2.运行redis-check-aof –fix进行修复<br>3.用diff -u来看下两个文件的差异，确认问题点<br>4.重启redis，加载修复后的AOF文件</p>
<h3 id="redis持久化-–-AOF重写"><a href="#redis持久化-–-AOF重写" class="headerlink" title="redis持久化 – AOF重写"></a>redis持久化 – AOF重写</h3><p>AOF重写的内部运行原理，我们有必要了解一下。</p>
<p>在重写即将开始之际，redis会创建（fork）一个“重写子进程”，这个子进程会首先读取现有的AOF文件，并将其包含的指令进行分析压缩并写入到一个临时文件中。</p>
<p>与此同时，主工作进程会将新接收到的写指令一边累积到内存缓冲区中，一边继续写入到原有的AOF文件中，这样做是保证原有的AOF文件的可用性，避免在重写过程中出现意外。</p>
<p>当“重写子进程”完成重写工作后，它会给父进程发一个信号，父进程收到信号后就会将内存中缓存的写指令追加到新AOF文件中。</p>
<p>当追加结束后，redis就会用新AOF文件来代替旧AOF文件，之后再有新的写指令，就都会追加到新的AOF文件中了。</p>
<h2 id="redis持久化-–-如何选择RDB和AOF"><a href="#redis持久化-–-如何选择RDB和AOF" class="headerlink" title="redis持久化 – 如何选择RDB和AOF"></a>redis持久化 – 如何选择RDB和AOF</h2><p>对于我们应该选择RDB还是AOF，官方的建议是两个同时使用。这样可以提供更可靠的持久化方案。</p>
<h1 id="redis主从-–-介绍"><a href="#redis主从-–-介绍" class="headerlink" title="redis主从 – 介绍"></a>redis主从 – 介绍</h1><p>像<code>MySQL</code>一样，redis是支持主从同步的，而且也支持一主多从以及多级从结构。</p>
<p>主从结构，一是为了纯粹的冗余备份，二是为了提升读性能，比如很消耗性能的SORT就可以由从服务器来承担。</p>
<p>redis的主从同步是<code>异步</code>进行的，这意味着主从同步不会影响主逻辑，也不会降低redis的处理性能。</p>
<p>主从架构中，可以考虑关闭主服务器的数据持久化功能，只让从服务器进行持久化，这样可以提高主服务器的处理性能。</p>
<p>在主从架构中，从服务器通常被设置为<code>只读模式</code>，这样可以避免从服务器的数据被误修改。但是从服务器仍然可以接受CONFIG等指令，所以还是不应该将从服务器直接暴露到不安全的网络环境中。如果必须如此，那可以考虑给重要指令进行重命名，来避免命令被外人误执行。</p>
<h2 id="redis主从-–-同步原理"><a href="#redis主从-–-同步原理" class="headerlink" title="redis主从 – 同步原理"></a>redis主从 – 同步原理</h2><p>从服务器会向主服务器发出SYNC指令，当主服务器接到此命令后，就会调用BGSAVE指令来创建一个子进程专门进行数据持久化工作，也就是将主服务器的数据写入RDB文件中。在数据持久化期间，主服务器将执行的写指令都缓存在内存中。</p>
<p>在BGSAVE指令执行完成后，主服务器会将持久化好的RDB文件发送给从服务器，从服务器接到此文件后会将其存储到磁盘上，然后再将其读取到内存中。这个动作完成后，主服务器会将这段时间缓存的写指令再以redis协议的格式发送给从服务器。</p>
<p>另外，要说的一点是，即使有多个从服务器同时发来SYNC指令，主服务器也只会执行一次BGSAVE，然后把持久化好的RDB文件发给多个下游。在redis2.8版本之前，如果从服务器与主服务器因某些原因断开连接的话，都会进行一次主从之间的全量的数据同步；而在2.8版本之后，redis支持了效率更高的增量同步策略，这大大降低了连接断开的恢复成本。</p>
<p>主服务器会在内存中维护一个缓冲区，缓冲区中存储着将要发给从服务器的内容。从服务器在与主服务器出现网络瞬断之后，从服务器会尝试再次与主服务器连接，一旦连接成功，从服务器就会把“希望同步的主服务器ID”和“希望请求的数据的偏移位置（replication offset）”发送出去。主服务器接收到这样的同步请求后，首先会验证主服务器ID是否和自己的ID匹配，其次会检查“请求的偏移位置”是否存在于自己的缓冲区中，如果两者都满足的话，主服务器就会向从服务器发送增量内容。</p>
<p>增量同步功能，需要服务器端支持全新的PSYNC指令。这个指令，只有在redis-2.8之后才具有。</p>
<h1 id="redis事务"><a href="#redis事务" class="headerlink" title="redis事务"></a>redis事务</h1><p>众所周知，事务是指“一个完整的动作，要么全部执行，要么什么也没有做”。</p>
<p>在聊redis事务处理之前，要先和大家介绍四个redis指令，即MULTI、EXEC、DISCARD、WATCH。这四个指令构成了redis事务处理的基础。</p>
<p>1.MULTI用来组装一个事务；<br>2.EXEC用来执行一个事务；<br>3.DISCARD用来取消一个事务；<br>4.WATCH用来监视一些key，一旦这些key在事务执行之前被改变，则取消事务的执行。</p>
<p>纸上得来终觉浅，我们来看一个MULTI和EXEC的例子：</p>
<pre class="line-numbers language-bash"><code class="language-bash">redis<span class="token operator">></span> MULTI //标记事务开始
OK
redis<span class="token operator">></span> INCR user_id //多条命令按顺序入队
QUEUED
redis<span class="token operator">></span> INCR user_id
QUEUED
redis<span class="token operator">></span> INCR user_id
QUEUED
redis<span class="token operator">></span> PING
QUEUED
redis<span class="token operator">></span> EXEC //执行
1<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
2<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
3<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
4<span class="token punctuation">)</span> PONG
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在上面的例子中，我们看到了QUEUED的字样，这表示我们在用MULTI组装事务时，每一个命令都会进入到内存队列中缓存起来，如果出现QUEUED则表示我们这个命令成功插入了缓存队列，在将来执行EXEC时，这些被QUEUED的命令都会被组装成一个事务来执行。</p>
<p>对于事务的执行来说，如果redis开启了AOF持久化的话，那么一旦事务被成功执行，事务中的命令就会通过write命令一次性写到磁盘中去，如果在向磁盘中写的过程中恰好出现断电、硬件故障等问题，那么就可能出现只有部分命令进行了AOF持久化，这时AOF文件就会出现不完整的情况，这时，我们可以使用redis-check-aof工具来修复这一问题，这个工具会将AOF文件中不完整的信息移除，确保AOF文件完整可用。</p>
<p>有关事务，大家经常会遇到的是两类错误：</p>
<p>1.调用EXEC之前的错误<br>2.调用EXEC之后的错误</p>
<p>“调用EXEC之前的错误”，有可能是由于语法有误导致的，也可能时由于内存不足导致的。只要出现某个命令无法成功写入缓冲队列的情况，redis都会进行记录，在客户端调用EXEC时，redis会拒绝执行这一事务。（这时2.6.5版本之后的策略。在2.6.5之前的版本中，redis会忽略那些入队失败的命令，只执行那些入队成功的命令）。我们来看一个这样的例子：</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> haha //一个明显错误的指令
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown <span class="token function">command</span> <span class="token string">'haha'</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token function">ping</span>
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span>
//redis无情的拒绝了事务的执行，原因是“之前出现了错误”
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>而对于“调用EXEC之后的错误”，redis则采取了完全不同的策略，即redis不会理睬这些错误，而是继续向下执行事务中的其他命令。这是因为，对于应用层面的错误，并不是redis自身需要考虑和处理的问题，所以一个事务中如果某一条命令执行失败，并不会影响接下来的其他命令的执行。我们也来看一个例子：</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> age 23
QUEUED
//age不是集合，所以如下是一条明显错误的指令
127.0.0.1:6379<span class="token operator">></span> sadd age 15
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> age 29
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span> //执行事务时，redis不会理睬第2条指令执行错误
1<span class="token punctuation">)</span> OK
2<span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> WRONGTYPE Operation against a key holding the wrong kind of value
3<span class="token punctuation">)</span> OK
127.0.0.1:6379<span class="token operator">></span> get age
<span class="token string">"29"</span> //可以看出第3条指令被成功执行了
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>好了，我们来说说最后一个指令“WATCH”，这是一个很好用的指令，它可以帮我们实现类似于“乐观锁”的效果，即CAS（check and set）。</p>
<p>WATCH本身的作用是“监视key是否被改动过”，而且支持同时监视多个key，只要还没真正触发事务，WATCH都会尽职尽责的监视，一旦发现某个key被修改了，在执行EXEC时就会返回nil，表示事务无法触发。</p>
<pre class="line-numbers language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> age 23
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token function">watch</span> age //开始监视age
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> age 24 //在EXEC之前，age的值被修改了
OK
127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> age 25
QUEUED
127.0.0.1:6379<span class="token operator">></span> get age
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span> //触发EXEC
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span> //事务无法被执行
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="redis配置-–-简介"><a href="#redis配置-–-简介" class="headerlink" title="redis配置 – 简介"></a>redis配置 – 简介</h1><p>我们可以在启动redis-server时指定应该加载的配置文件，方法如下：</p>
<pre class="line-numbers language-bash"><code class="language-bash"> /redis-server /path/to/redis.conf
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>接下来，我们就来讲解下redis配置文件的各个配置项的含义，注意，本文是基于redis-2.8.4版本进行讲解的。</p>
<p>redis官方提供的redis.conf文件，足有700+行，其中100多行为有效配置行，另外的600多行为注释说明。</p>
<p>在配置文件的开头部分，首先明确了一些度量单位：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1k => 1000 bytes</span>
<span class="token comment" spellcheck="true"># 1kb => 1024 bytes</span>
<span class="token comment" spellcheck="true"># 1m => 1000000 bytes</span>
<span class="token comment" spellcheck="true"># 1mb => 1024*1024 bytes</span>
<span class="token comment" spellcheck="true"># 1g => 1000000000 bytes</span>
<span class="token comment" spellcheck="true"># 1gb => 1024*1024*1024 bytes</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看出，redis配置中对单位的大小写不敏感，1GB、1Gb和1gB都是相同的。由此也说明，redis只支持bytes，不支持bit单位。</p>
<p>redis支持“主配置文件中引入外部配置文件”，很像C/C++中的include指令，比如：</p>
<p><code>include /path/to/other.conf</code></p>
<p>如果你看过redis的配置文件，会发现还是很有条理的。redis配置文件被分成了几大块区域，它们分别是：</p>
<p>1.通用（general）<br>2.快照（snapshotting）<br>3.复制（replication）<br>4.安全（security）<br>5.限制（limits)<br>6.追加模式（append only mode)<br>7.LUA脚本（lua scripting)<br>8.慢日志（slow log)<br>9.事件通知（event notification）</p>
<h1 id="redis配置-–-通用"><a href="#redis配置-–-通用" class="headerlink" title="redis配置 – 通用"></a>redis配置 – 通用</h1><p>默认情况下，redis并不是以daemon形式来运行的。通过daemonize配置项可以控制redis的运行形式，如果改为yes，那么redis就会以daemon形式运行：</p>
<p><code>daemonize no</code></p>
<p>当以daemon形式运行时，redis会生成一个pid文件，默认会生成在/var/run/redis.pid。当然，你可以通过pidfile来指定pid文件生成的位置，比如：</p>
<p><code>pidfile /path/to/redis.pid</code></p>
<p>默认情况下，redis会响应本机所有可用网卡的连接请求。当然，redis允许你通过bind配置项来指定要绑定的IP，比如：</p>
<p><code>bind 192.168.1.2 10.8.4.2</code></p>
<p>redis的默认服务端口是6379，你可以通过port配置项来修改。如果端口设置为0的话，redis便不会监听端口了。</p>
<p><code>port 6379</code></p>
<p>有些同学会问“如果redis不监听端口，还怎么与外界通信呢”，其实redis还支持通过unix socket方式来接收请求。可以通过unixsocket配置项来指定unix socket文件的路径，并通过unixsocketperm来指定文件的权限。</p>
<pre class="line-numbers language-bash"><code class="language-bash">unixsocket /tmp/redis.sock
unixsocketperm 755
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>当一个redis-client一直没有请求发向server端，那么server端有权主动关闭这个连接，可以通过timeout来设置“空闲超时时限”，0表示永不关闭。</p>
<p><code>timeout 0</code></p>
<p>TCP连接保活策略，可以通过tcp-keepalive配置项来进行设置，单位为秒，假如设置为60秒，则server端会每60秒向连接空闲的客户端发起一次ACK请求，以检查客户端是否已经挂掉，对于无响应的客户端则会关闭其连接。所以关闭一个连接最长需要120秒的时间。如果设置为0，则不会进行保活检测。</p>
<p><code>tcp-keepalive 0</code></p>
<p>redis支持通过loglevel配置项设置日志等级，共分四级，即debug、verbose、notice、warning。</p>
<p><code>loglevel notice</code></p>
<p>redis也支持通过logfile配置项来设置日志文件的生成位置。如果设置为空字符串，则redis会将日志输出到标准输出。假如你在daemon情况下将日志设置为输出到标准输出，则日志会被写到/dev/null中。</p>
<p><code>logfile &quot;&quot;</code></p>
<p>如果希望日志打印到syslog中，也很容易，通过syslog-enabled来控制。另外，syslog-ident还可以让你指定syslog里的日志标志，比如：</p>
<p><code>syslog-ident redis</code></p>
<p>而且还支持指定syslog设备，值可以是USER或LOCAL0-LOCAL7。具体可以参考syslog服务本身的用法。</p>
<p><code>syslog-facility local0</code></p>
<p>对于redis来说，可以设置其数据库的总数量，假如你希望一个redis包含16个数据库，那么设置如下：</p>
<p><code>databases 16</code></p>
<p>这16个数据库的编号将是0到15。默认的数据库是编号为0的数据库。用户可以使用select来选择相应的数据库。</p>
<h2 id="redis配置-快照"><a href="#redis配置-快照" class="headerlink" title="redis配置 - 快照"></a>redis配置 - 快照</h2><p>快照，主要涉及的是redis的RDB持久化相关的配置，我们来一起看一看。</p>
<p>我们可以用如下的指令来让数据保存到磁盘上，即控制RDB快照功能：</p>
<p><code>save &lt;seconds&gt; &lt;changes&gt;</code></p>
<pre class="line-numbers language-bash"><code class="language-bash">save 900 1 //表示每15分钟且至少有1个key改变，就触发一次持久化
save 300 10 //表示每5分钟且至少有10个key改变，就触发一次持久化
save 60 10000 //表示每60秒至少有10000个key改变，就触发一次持久化
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>如果你想禁用RDB持久化的策略，只要不设置任何save指令就可以，或者给save传入一个空字符串参数也可以达到相同效果，就像这样：</p>
<p><code>save &quot;&quot;</code></p>
<p>如果用户开启了RDB快照功能，那么在redis持久化数据到磁盘时如果出现失败，默认情况下，redis会停止接受所有的写请求。这样做的好处在于可以让用户很明确的知道内存中的数据和磁盘上的数据已经存在不一致了。如果redis不顾这种不一致，一意孤行的继续接收写请求，就可能会引起一些灾难性的后果。</p>
<p>如果下一次RDB持久化成功，redis会自动恢复接受写请求。</p>
<p>当然，如果你不在乎这种数据不一致或者有其他的手段发现和控制这种不一致的话，你完全可以关闭这个功能，以便在快照写入失败时，也能确保redis继续接受新的写请求。配置项如下：</p>
<p><code>stop-writes-on-bgsave-error yes</code></p>
<p>对于存储到磁盘中的快照，可以设置是否进行压缩存储。如果是的话，redis会采用LZF算法进行压缩。如果你不想消耗CPU来进行压缩的话，可以设置为关闭此功能，但是存储在磁盘上的快照会比较大。</p>
<p><code>rdbcompression yes</code></p>
<p>在存储快照后，我们还可以让redis使用CRC64算法来进行数据校验，但是这样做会增加大约10%的性能消耗，如果你希望获取到最大的性能提升，可以关闭此功能。</p>
<p><code>rdbchecksum yes</code></p>
<p>我们还可以设置快照文件的名称，默认是这样配置的：</p>
<p><code>dbfilename dump.rdb</code></p>
<p>最后，你还可以设置这个快照文件存放的路径。比如默认设置就是当前文件夹：</p>
<p><code>dir ./</code></p>
<h2 id="redis配置-–-复制"><a href="#redis配置-–-复制" class="headerlink" title="redis配置 – 复制"></a>redis配置 – 复制</h2><p>redis提供了主从同步功能。</p>
<p>通过slaveof配置项可以控制某一个redis作为另一个redis的从服务器，通过指定IP和端口来定位到主redis的位置。一般情况下，我们会建议用户为从redis设置一个不同频率的快照持久化的周期，或者为从redis配置一个不同的服务端口等等。</p>
<p><code>slaveof &lt;masterip&gt; &lt;masterport&gt;</code></p>
<p>如果主redis设置了验证密码的话（使用requirepass来设置），则在从redis的配置中要使用masterauth来设置校验密码，否则的话，主redis会拒绝从redis的访问请求。</p>
<p><code>masterauth &lt;master-password&gt;</code></p>
<p>当从redis失去了与主redis的连接，或者主从同步正在进行中时，redis该如何处理外部发来的访问请求呢这里，从redis可以有两种选择：</p>
<p>第一种选择：如果slave-serve-stale-data设置为yes（默认），则从redis仍会继续响应客户端的读写请求。</p>
<p>第二种选择：如果slave-serve-stale-data设置为no，则从redis会对客户端的请求返回“SYNC with master in progress”，当然也有例外，当客户端发来INFO请求和SLAVEOF请求，从redis还是会进行处理。</p>
<p>你可以控制一个从redis是否可以接受写请求。将数据直接写入从redis，一般只适用于那些生命周期非常短的数据，因为在主从同步时，这些临时数据就会被清理掉。自从redis2.6版本之后，默认从redis为只读。</p>
<p><code>slave-read-only yes</code></p>
<p>只读的从redis并不适合直接暴露给不可信的客户端。为了尽量降低风险，可以使用rename-command指令来将一些可能有破坏力的命令重命名，避免外部直接调用。比如：</p>
<p><code>rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</code></p>
<p>从redis会周期性的向主redis发出PING包。你可以通过repl_ping_slave_period指令来控制其周期。默认是10秒。</p>
<p><code>repl-ping-slave-period 10</code></p>
<p>在主从同步时，可能在这些情况下会有超时发生：</p>
<p>1.以从redis的角度来看，当有大规模IO传输时。<br>2.以从redis的角度来看，当数据传输或PING时，主redis超时<br>3.以主redis的角度来看，在回复从redis的PING时，从redis超时</p>
<p>用户可以设置上述超时的时限，不过要确保这个时限比repl-ping-slave-period的值要大，否则每次主redis都会认为从redis超时。</p>
<p><code>repl-timeout 60</code></p>
<p>我们可以控制在主从同步时是否禁用TCP_NODELAY。如果开启TCP_NODELAY，那么主redis会使用更少的TCP包和更少的带宽来向从redis传输数据。但是这可能会增加一些同步的延迟，大概会达到40毫秒左右。如果你关闭了TCP_NODELAY，那么数据同步的延迟时间会降低，但是会消耗更多的带宽。（如果你不了解TCP_NODELAY，可以到这里来科普一下）。</p>
<p><code>repl-disable-tcp-nodelay no</code></p>
<p>我们还可以设置同步队列长度。队列长度（backlog)是主redis中的一个缓冲区，在与从redis断开连接期间，主redis会用这个缓冲区来缓存应该发给从redis的数据。这样的话，当从redis重新连接上之后，就不必重新全量同步数据，只需要同步这部分增量数据即可。</p>
<p><code>repl-backlog-size 1mb</code></p>
<p>如果主redis等了一段时间之后，还是无法连接到从redis，那么缓冲队列中的数据将被清理掉。我们可以设置主redis要等待的时间长度。如果设置为0，则表示永远不清理。默认是1个小时。</p>
<p><code>repl-backlog-ttl 3600</code></p>
<p>我们可以给众多的从redis设置优先级，在主redis持续工作不正常的情况，优先级高的从redis将会升级为主redis。而编号越小，优先级越高。比如一个主redis有三个从redis，优先级编号分别为10、100、25，那么编号为10的从redis将会被首先选中升级为主redis。当优先级被设置为0时，这个从redis将永远也不会被选中。默认的优先级为100。</p>
<p><code>slave-priority 100</code></p>
<p>假如主redis发现有超过M个从redis的连接延时大于N秒，那么主redis就停止接受外来的写请求。这是因为从redis一般会每秒钟都向主redis发出PING，而主redis会记录每一个从redis最近一次发来PING的时间点，所以主redis能够了解每一个从redis的运行情况。</p>
<p><code>min-slaves-to-write 3</code><br><code>min-slaves-max-lag 10</code></p>
<p>上面这个例子表示，假如有大于等于3个从redis的连接延迟大于10秒，那么主redis就不再接受外部的写请求。上述两个配置中有一个被置为0，则这个特性将被关闭。默认情况下min-slaves-to-write为0，而min-slaves-max-lag为10。</p>
<h2 id="redis配置-安全"><a href="#redis配置-安全" class="headerlink" title="redis配置 - 安全"></a>redis配置 - 安全</h2><p>我们可以要求redis客户端在向redis-server发送请求之前，先进行密码验证。当你的redis-server处于一个不太可信的网络环境中时，相信你会用上这个功能。由于redis性能非常高，所以每秒钟可以完成多达15万次的密码尝试，所以你最好设置一个足够复杂的密码，否则很容易被黑客破解。</p>
<p><code>requirepass zhimakaimen</code></p>
<p>这里我们通过requirepass将密码设置成“芝麻开门”。</p>
<p>redis允许我们对redis指令进行更名，比如将一些比较危险的命令改个名字，避免被误执行。比如可以把CONFIG命令改成一个很复杂的名字，这样可以避免外部的调用，同时还可以满足内部调用的需要：</p>
<p><code>rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c89</code></p>
<p>我们甚至可以禁用掉CONFIG命令，那就是把CONFIG的名字改成一个空字符串：</p>
<p><code>rename-command CONFIG &quot;&quot;</code></p>
<p>但需要注意的是，如果你使用AOF方式进行数据持久化，或者需要与从redis进行通信，那么更改指令的名字可能会引起一些问题。</p>
<h2 id="redis配置-限制"><a href="#redis配置-限制" class="headerlink" title="redis配置 - 限制"></a>redis配置 - 限制</h2><p>我们可以设置redis同时可以与多少个客户端进行连接。默认情况下为10000个客户端。当你无法设置进程文件句柄限制时，redis会设置为当前的文件句柄限制值减去32，因为redis会为自身内部处理逻辑留一些句柄出来。</p>
<p>如果达到了此限制，redis则会拒绝新的连接请求，并且向这些连接请求方发出“max number of clients reached”以作回应。</p>
<p><code>maxclients 10000</code></p>
<p>我们甚至可以设置redis可以使用的内存量。一旦到达内存使用上限，redis将会试图移除内部数据，移除规则可以通过<code>maxmemory-policy</code>来指定。</p>
<p>如果redis无法根据移除规则来移除内存中的数据，或者我们设置了“不允许移除”，那么redis则会针对那些需要申请内存的指令返回错误信息，比如SET、LPUSH等。但是对于无内存申请的指令，仍然会正常响应，比如GET等。</p>
<p><code>maxmemory &lt;bytes&gt;</code></p>
<p>需要注意的一点是，如果你的redis是主redis（说明你的redis有从redis），那么在设置内存使用上限时，需要在系统中留出一些内存空间给同步队列缓存，只有在你设置的是“不移除”的情况下，才不用考虑这个因素。</p>
<p>对于内存移除规则来说，redis提供了多达6种的移除规则。他们是：</p>
<p>1.<code>volatile-lru</code>：使用LRU算法移除过期集合中的key<br>2.<code>allkeys-lru</code>：使用LRU算法移除key<br>3.<code>volatile-random</code>：在过期集合中移除随机的key<br>4.<code>allkeys-random</code>：移除随机的key<br>5.<code>volatile-ttl</code>：移除那些TTL值最小的key，即那些最近才过期的key。<br>6.<code>noeviction</code>：不进行移除。针对写操作，只是返回错误信息。</p>
<p>无论使用上述哪一种移除规则，如果没有合适的key可以移除的话，redis都会针对写请求返回错误信息。</p>
<p><code>maxmemory-policy volatile-lru</code></p>
<p>LRU算法和最小TTL算法都并非是精确的算法，而是估算值。所以你可以设置样本的大小。假如redis默认会检查三个key并选择其中LRU的那个，那么你可以改变这个key样本的数量。</p>
<p><code>maxmemory-samples 3</code></p>
<p>最后，我们补充一个信息，那就是到目前版本（2.8.4）为止，redis支持的写指令包括了如下这些：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">set</span> setnx setex append
incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd
sinter sinterstore sunion sunionstore <span class="token function">sdiff</span> sdiffstore zadd zincrby
zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby
getset mset msetnx <span class="token function">exec</span> <span class="token function">sort</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="redis配置-追加模式"><a href="#redis配置-追加模式" class="headerlink" title="redis配置 - 追加模式"></a>redis配置 - 追加模式</h2><p>默认情况下，redis会异步的将数据持久化到磁盘。这种模式在大部分应用程序中已被验证是很有效的，但是在一些问题发生时，比如断电，则这种机制可能会导致数分钟的写请求丢失。</p>
<p>如博文上半部分中介绍的，追加文件（Append Only File）是一种更好的保持数据一致性的方式。即使当服务器断电时，也仅会有1秒钟的写请求丢失，当redis进程出现问题且操作系统运行正常时，甚至只会丢失一条写请求。</p>
<p>我们建议大家，AOF机制和RDB机制可以同时使用，不会有任何冲突。对于如何保持数据一致性的讨论，请参见本文。</p>
<p><code>appendonly no</code></p>
<p>我们还可以设置aof文件的名称：</p>
<p><code>appendfilename &quot;appendonly.aof&quot;</code></p>
<p><code>fsync()</code>调用，用来告诉操作系统立即将缓存的指令写入磁盘。一些操作系统会“立即”进行，而另外一些操作系统则会“尽快”进行。</p>
<p>redis支持三种不同的模式：</p>
<p>1.<code>no</code>：不调用fsync()。而是让操作系统自行决定sync的时间。这种模式下，redis的性能会最快。<br>2.<code>always</code>：在每次写请求后都调用fsync()。这种模式下，redis会相对较慢，但数据最安全。<br>3.<code>everysec</code>：每秒钟调用一次fsync()。这是性能和安全的折衷。</p>
<p>默认情况下为<code>everysec</code>。有关数据一致性的揭秘，可以参考本文。</p>
<p><code>appendfsync everysec</code></p>
<p>当<code>fsync</code>方式设置为<code>always</code>或<code>everysec</code>时，如果后台持久化进程需要执行一个很大的磁盘IO操作，那么redis可能会在<code>fsync()</code>调用时卡住。目前尚未修复这个问题，这是因为即使我们在另一个新的线程中去执行<code>fsync()</code>，也会阻塞住同步写调用。</p>
<p>为了缓解这个问题，我们可以使用下面的配置项，这样的话，当<code>BGSAVE</code>或<code>BGWRITEAOF</code>运行时，fsync()在主进程中的调用会被阻止。这意味着当另一路进程正在对AOF文件进行重构时，redis的持久化功能就失效了，就好像我们设置了“appendsync none”一样。如果你的redis有时延问题，那么请将下面的选项设置为yes。否则请保持no，因为这是保证数据完整性的最安全的选择。</p>
<p><code>no-appendfsync-on-rewrite no</code></p>
<p>我们允许redis自动重写aof。当aof增长到一定规模时，redis会隐式调用<code>BGREWRITEAOF</code>来重写log文件，以缩减文件体积。</p>
<p>redis是这样工作的：redis会记录上次重写时的aof大小。假如redis自启动至今还没有进行过重写，那么启动时aof文件的大小会被作为基准值。这个基准值会和当前的aof大小进行比较。如果当前aof大小超出所设置的增长比例，则会触发重写。另外，你还需要设置一个最小大小，是为了防止在aof很小时就触发重写。</p>
<p><code>auto-aof-rewrite-percentage 100</code><br><code>auto-aof-rewrite-min-size 64mb</code></p>
<p>如果设置<code>auto-aof-rewrite-percentage</code>为<code>0</code>，则会关闭此重写功能。</p>
<h2 id="redis配置-–-LUA脚本"><a href="#redis配置-–-LUA脚本" class="headerlink" title="redis配置 – LUA脚本"></a>redis配置 – LUA脚本</h2><p><code>lua</code>脚本的最大运行时间是需要被严格限制的，要注意单位是毫秒：</p>
<p><code>lua-time-limit 5000</code></p>
<p>如果此值设置为<code>0</code>或负数，则既不会有报错也不会有时间限制。</p>
<h2 id="redis配置-–-慢日志"><a href="#redis配置-–-慢日志" class="headerlink" title="redis配置 – 慢日志"></a>redis配置 – 慢日志</h2><p>redis慢日志是指一个系统进行日志查询超过了指定的时长。这个时长不包括IO操作，比如与客户端的交互、发送响应内容等，而仅包括实际执行查询命令的时间。</p>
<p>针对慢日志，你可以设置两个参数，一个是执行时长，单位是微秒，另一个是慢日志的长度。当一个新的命令被写入日志时，最老的一条会从命令日志队列中被移除。</p>
<p>单位是微秒，即1000000表示一秒。负数则会禁用慢日志功能，而0则表示强制记录每一个命令。</p>
<p><code>slowlog-log-slower-than 10000</code></p>
<p>慢日志最大长度，可以随便填写数值，没有上限，但要注意它会消耗内存。你可以使用<code>SLOWLOG RESET</code>来重设这个值。</p>
<p><code>slowlog-max-len 128</code></p>
<h2 id="redis配置-–-事件通知"><a href="#redis配置-–-事件通知" class="headerlink" title="redis配置 – 事件通知"></a>redis配置 – 事件通知</h2><p>redis可以向客户端通知某些事件的发生。这个特性的具体解释可以参见本文。</p>
<h2 id="redis配置-–-高级配置"><a href="#redis配置-–-高级配置" class="headerlink" title="redis配置 – 高级配置"></a>redis配置 – 高级配置</h2><p>有关哈希数据结构的一些配置项：</p>
<p><code>hash-max-ziplist-entries 512</code><br><code>hash-max-ziplist-value 64</code></p>
<p>有关列表数据结构的一些配置项：</p>
<p><code>list-max-ziplist-entries 512</code><br><code>list-max-ziplist-value 64</code></p>
<p>有关集合数据结构的配置项：</p>
<p><code>set-max-intset-entries 512</code></p>
<p>有关有序集合数据结构的配置项：</p>
<p><code>zset-max-ziplist-entries 128</code><br><code>zset-max-ziplist-value 64</code></p>
<p>关于是否需要再哈希的配置项：</p>
<p><code>activerehashing yes</code></p>
<p>关于客户端输出缓冲的控制项：</p>
<pre class="line-numbers language-bash"><code class="language-bash">client-output-buffer-limit normal 0 0 0
client-output-buffer-limit slave 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>有关频率的配置项：</p>
<p><code>hz 10</code></p>
<p>有关重写aof的配置项</p>
<p><code>aof-rewrite-incremental-fsync yes</code></p>
<h1 id="redis哨兵机制-Sentinel"><a href="#redis哨兵机制-Sentinel" class="headerlink" title="redis哨兵机制 - Sentinel"></a>redis哨兵机制 - Sentinel</h1><h2 id="Sentinel的作用"><a href="#Sentinel的作用" class="headerlink" title="Sentinel的作用"></a>Sentinel的作用</h2><p>A、Master 状态监测</p>
<p>B、如果Master 异常，则会进行Master-slave 转换，将其中数据最新的一个Slave作为Master，将之前的Master作为Slave</p>
<p>C、Master-Slave切换后，master_redis.conf、slave_redis.conf和sentinel.conf的内容都会发生改变，即master_redis.conf中会多一行slaveof的配置，sentinel.conf的监控目标会随之调换</p>
<h2 id="Sentinel的工作方式"><a href="#Sentinel的工作方式" class="headerlink" title="Sentinel的工作方式"></a>Sentinel的工作方式</h2><p>1)：每个Sentinel以每秒钟一次的频率向它所知的Master，Slave以及其他 Sentinel 实例发送一个 PING 命令</p>
<p>2)：如果一个实例（instance）距离最后一次有效回复 PING 命令的时间超过 down-after-milliseconds 选项所指定的值， 则这个实例会被 Sentinel 标记为主观下线。</p>
<p>3)：如果一个Master被标记为主观下线，则正在监视这个Master的所有 Sentinel 要以每秒一次的频率确认Master的确进入了主观下线状态。</p>
<p>4)：当有足够数量的 Sentinel（大于等于配置文件指定的值）在指定的时间范围内确认Master的确进入了主观下线状态， 则Master会被标记为客观下线</p>
<p>5)：在一般情况下， 每个 Sentinel 会以每 10 秒一次的频率向它已知的所有Master，Slave发送 INFO 命令</p>
<p>6)：当Master被 Sentinel 标记为客观下线时，Sentinel 向下线的 Master 的所有 Slave 发送 INFO 命令的频率会从 10 秒一次改为每秒一次</p>
<p>7)：若没有足够数量的 Sentinel 同意 Master 已经下线， Master 的客观下线状态就会被移除。</p>
<p>若 Master 重新向 Sentinel 的 PING 命令返回有效回复， Master 的主观下线状态就会被移除。</p>
<h2 id="Sentinel简要搭建方法"><a href="#Sentinel简要搭建方法" class="headerlink" title="Sentinel简要搭建方法"></a>Sentinel简要搭建方法</h2><h3 id="环境概要"><a href="#环境概要" class="headerlink" title="环境概要"></a>环境概要</h3><p>模拟搭建一主两从的sentinel服务集群，准备好三台虚拟机，每台机器部署一个redis实例服务和一个sentinel哨兵服务，其中选定10.7.3.88机器上的redis服务为Master，其他两台机器的redis服务为Slave。具体如下：</p>
<table>
<thead>
<tr>
<th>机器IP</th>
<th>redis实例</th>
<th>角色</th>
<th>sentinel服务</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.7.3.88</td>
<td>实例1（6379)</td>
<td>主</td>
<td>yes</td>
</tr>
<tr>
<td>10.7.3.50</td>
<td>实例2（6379)</td>
<td>从</td>
<td>yes</td>
</tr>
<tr>
<td>10.7.3.60</td>
<td>实例3（6379)</td>
<td>从</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p>  集群搭建后，其中任意一个redis服务down掉后，该集群继续可用。</p>
<h3 id="设置主从服务"><a href="#设置主从服务" class="headerlink" title="设置主从服务"></a>设置主从服务</h3><p>redis主从配置非常简单，有两种方式：文件配置和命令配置。文件配置是永久性的，命令配置是临时有效的。不过，这两种方法的共同点是只需要对从服务进行设置。下面分别介绍两种方式：</p>
<p>文件配置，修改从redis服务的配置文件，加上如下内容：<br><code>slaveof 10.7.3.88 6379</code></p>
<p>命令配置，连接从redis服务，执行如下命令即可：<br><code>slaveof 10.7.3.88 6379</code><br><code># slaveof no one #取消主从配置</code></p>
<p>按照上述方法分别对10.7.3.50和10.7.3.60上的redis服务进行设置，设置完成之后可以通过如下命令进行查看主从配置信息：<br><code>redis-cli info replication</code></p>
<p>主从配置，主服务可写可读，从服务只能读取。<br>主从配置测试，可以先通过在主服务写入数据，然后再登录其服务查看刚才写入的数据，如果一致，则表示主从配置顺利完成。如果数据不一致，请先检查是否因为防火墙导致数据传输失败。</p>
<h3 id="配置sentinel服务"><a href="#配置sentinel服务" class="headerlink" title="配置sentinel服务"></a>配置sentinel服务</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## sentinel实例之间的通讯端口，不同的sentinel服务实例不同端口号，本文选取26379,26479,26579</span>
port 26379
protected-mode <span class="token function">yes</span>
bind 0.0.0.0
daemonize <span class="token function">yes</span>
logfile <span class="token string">"/var/redis/sentinel.log"</span>
<span class="token comment" spellcheck="true">## 此指令最后一个参数为&lt;quorum>，表示选举时至少有quorum个sentinel实例推选某redis，它才能成为master</span>
sentinel monitor mymaster 10.7.3.88 6379 2
<span class="token comment" spellcheck="true">## 如果服务器在给定的毫秒数之内没有响应，那么 Sentinel 将这个服务器标记为主观下线（subjectively down，简称 SDOWN ）</span>
sentinel down-after-milliseconds mymaster 5000
<span class="token comment" spellcheck="true">## 不同sentinel并不会同时对同一个master做failover操作，failover操作间隔时间设置</span>
sentinel failover-timeout mymaster 15000
<span class="token comment" spellcheck="true">## 指定了在执行故障转移时，最多可以有多少个从Redis实例在同步新的主实例，在从Redis实例较多的情况下这个数字越小，同步的时间越长，完成故障转移所需的时间就越长</span>
sentinel parallel-syncs mymaster 1
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p> 上节已经确定主redis服务为10.7.3.88:6379,所以配置文件中定义该服务为主服务，服务名mymaster。其他从服务的sentinel配置，只需要修改port即可。</p>
<h3 id="命令测试sentinel服务"><a href="#命令测试sentinel服务" class="headerlink" title="命令测试sentinel服务"></a>命令测试sentinel服务</h3><p> 输入如下命令，强制主服务失效，然后观察日志。</p>
<p><code>redis-cli -p 10.7.3.88 -p 26379</code><br><code>sentinel failover mymaster</code></p>
<h1 id="redis集群-redis-cluster"><a href="#redis集群-redis-cluster" class="headerlink" title="redis集群 - redis cluster"></a>redis集群 - redis cluster</h1><h2 id="redis-cluster是什么"><a href="#redis-cluster是什么" class="headerlink" title="redis cluster是什么"></a>redis cluster是什么</h2><p>Redis Cluster 是Redis的集群实现，内置数据自动分片机制，集群内部将所有的key映射到16384个Slot中，集群中的每个Redis Instance负责其中的一部分的Slot的读写。<br>集群客户端连接集群中任一Redis Instance即可发送命令，当Redis Instance收到自己不负责的Slot的请求时，会将负责请求Key所在Slot的Redis Instance地址返回给客户端，客户端收到后自动将原请求重新发往这个地址，对外部透明。一个Key到底属于哪个Slot由crc16(key) % 16384 决定。</p>
<h2 id="redis-cluster结构特点"><a href="#redis-cluster结构特点" class="headerlink" title="redis cluster结构特点"></a>redis cluster结构特点</h2><p><img src="https://www.jifu.io/images/2/28204346_CM6r.jpg" alt=""><br>1、所有的redis节点彼此互联(PING-PONG机制),内部使用二进制协议优化传输速度和带宽。</p>
<p>2、节点的fail是通过集群中超过半数的节点检测失效时才生效。</p>
<p>3、客户端与redis节点直连,不需要中间proxy层.客户端不需要连接集群所有节点,连接集群中任何一个可用节点即可。</p>
<p>4、redis-cluster把所有的物理节点映射到[0-16383]slot上（不一定是平均分配）,cluster 负责维护node<->slot<->value。</-></-></p>
<p>5、Redis集群预分好16384个桶，当需要在 Redis 集群中放置一个 key-value 时，根据 CRC16(key) mod 16384的值，决定将一个key放到哪个桶中。</p>
<h2 id="Redis-Cluster主从模式"><a href="#Redis-Cluster主从模式" class="headerlink" title="Redis Cluster主从模式"></a>Redis Cluster主从模式</h2><p>redis cluster 为了保证数据的高可用性，加入了主从模式，一个主节点对应一个或多个从节点，主节点提供数据存取，从节点则是从主节点拉取数据备份，当这个主节点挂掉后，就会有这个从节点选取一个来充当主节点，从而保证集群不会挂掉。</p>
<p>假设集群有ABC三个主节点, 如果这3个节点都没有加入从节点，如果B挂掉了，我们就无法访问整个集群了。A和C的slot也无法访问。</p>
<p>所以我们在集群建立的时候，一定要为每个主节点都添加了从节点, 比如像这样, 集群包含主节点A、B、C, 以及从节点A1、B1、C1, 那么即使B挂掉系统也可以继续正确工作。</p>
<p>B1节点替代了B节点，所以Redis集群将会选择B1节点作为新的主节点，集群将会继续正确地提供服务。 当B重新开启后，它就会变成B1的从节点。</p>
<p>不过需要注意，如果节点B和B1同时挂了，Redis集群就无法继续正确地提供服务了。</p>
<p><code>缺陷</code>: 每次salave断开后,(无论是主动断开,还是网络故障) 再连接master，都要master全部dump出来rdb,再aof，即同步的过程都要重新执行1遍. 所以要记住—多台slave不要一下都启动起来,否则master可能IO剧增</p>
<h2 id="redis-cluster简要搭建方法"><a href="#redis-cluster简要搭建方法" class="headerlink" title="redis cluster简要搭建方法"></a>redis cluster简要搭建方法</h2><p><a href="https://my.oschina.net/u/3371837/blog/1795011" target="_blank" rel="noopener">TODO:</a></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p>-<a href="https://my.oschina.net/wuweixiang/blog/1796652" target="_blank" rel="noopener">超强、超详细Redis入门教程</a><br>-<a href="https://my.oschina.net/wuweixiang/blog/1796563" target="_blank" rel="noopener">Redis 存储机制</a><br>-<a href="https://my.oschina.net/zlb1992/blog/1512464" target="_blank" rel="noopener">Redis的两种持久化方式及原理</a><br>-<a href="https://my.oschina.net/sdlvzg/blog/1528061" target="_blank" rel="noopener">Redis redis-cli 命令列表</a><br>-<a href="https://my.oschina.net/u/3705388/blog/1609633" target="_blank" rel="noopener">redis高可用方案</a><br>-<a href="https://my.oschina.net/xiaohui249/blog/1611670" target="_blank" rel="noopener">玩转redis集群（二）—— 哨兵模式</a></p>
</blockquote>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>


    
<nav id="article-nav">
    
        <a href="/posts/4096440342/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    Python Library - SQLAlchemy
                
            </div>
        </a>
    
    
        <a href="/posts/4001059579/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">Compiling PyQt5 for Python2.7 on Mac OS</div>
        </a>
    
</nav>





    
    




<!-- baidu url auto push script -->
<script type="text/javascript">
    !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
</script>     

<head><meta name="generator" content="Hexo 3.9.0">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<link rel="stylesheet" href="/css/prism-duotone-light.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
<body>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: '8kLhebBkVygl1MhVcQx9dnBP-gzGzoHsz',
            appKey: 'hrctlOb6RQBWjjwTJ9fVjb91'
        })
    </script>
</body>


</section>
        </div>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            <a href="https://www.jifu.io">
            Ji Fu &copy; 2021
            </a>
            <br> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme - <a href="https://github.com/zthxxx/hexo-theme-Wikitten">wikitten</a>
            <br> 您是  jifu'wiki 的第<span id="busuanzi_value_site_uv"></span>个小伙伴
            <br>
                本站总访问量<span id="busuanzi_value_site_pv"></span>次
                本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </div>
    </div>
</footer>



        

    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>